<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>말씀따라 흐르는 샘물 · 달력</title>
  <meta name="color-scheme" content="light dark" />
  <style>
    :root{
      --fg:#111827; --muted:#6b7280; --line:#e5e7eb; --line-strong:#cbd5e1;
      --bg:#ffffff; --bgsoft:#f8fafc; --box:#ffffff; --tint:#f0f9ff; --accent:#0ea5e9;
    }
    @media (prefers-color-scheme: dark){
      :root{ --fg:#e5e7eb; --muted:#9ca3af; --line:#1f2937; --line-strong:#374151;
             --bg:#0b0f14; --bgsoft:#0f1720; --box:#0b1220; --tint:#0b1a2a; --accent:#38bdf8; }
    }
    *{box-sizing:border-box}
    body{margin:0;font-family:ui-sans-serif,system-ui,Segoe UI,Apple SD Gothic Neo,Noto Sans KR,Helvetica,Arial,sans-serif;color:var(--fg);background:var(--bgsoft)}
    .wrap{max-width:1080px;margin:24px auto;padding:0 16px}

    /* 연도/월 네비 - 요청하신 옛 스타일 */
    .yearbar{display:flex;align-items:center;justify-content:center;gap:16px;margin-bottom:8px}
    .yearbar a{appearance:none;border:1px solid var(--line);background:var(--box);color:var(--fg);
      padding:6px 12px;border-radius:999px;text-decoration:none;font-weight:700}
    .year{font-weight:900;letter-spacing:.02em}

    .months{display:flex;flex-wrap:wrap;gap:8px;justify-content:center;margin-bottom:16px}
    .months a{border:1px solid var(--line);background:var(--box);padding:6px 10px;border-radius:10px;text-decoration:none;color:var(--fg)}
    .months a.active{outline:2px solid var(--accent)}

    .cal{background:var(--box);border:1px solid var(--line);border-radius:14px;overflow:hidden}
    .cal .head{display:grid;grid-template-columns:repeat(7,1fr);border-bottom:1px solid var(--line-strong);background:var(--tint)}
    .cal .head div{padding:10px 8px;text-align:center;font-weight:700}
    .cal .grid{display:grid;grid-template-columns:repeat(7,1fr)}

    .day{min-height:120px;border-right:1px solid var(--line);border-bottom:1px solid var(--line);padding:8px;display:flex;flex-direction:column;gap:6px}
    .day:nth-child(7n){border-right:none}
    .date{font-weight:700;font-size:13px;opacity:.95}
    .title a{font-size:14px;line-height:1.25;text-decoration:none;color:inherit}
    .title a:hover{opacity:.85}
    .empty{background:linear-gradient(180deg, color-mix(in oklab, var(--tint) 35%, transparent), transparent)}

    @media (max-width:720px){ .day{min-height:96px} .title a{font-size:13px} }
  </style>
</head>
<body>
  <div class="wrap">
    <!-- 상단: 연도 좌우 화살표 + 현재 연도 라벨 -->
    <nav class="yearbar" aria-label="연도 네비게이션">
      <a id="yearPrev" href="#" aria-label="이전 연도">◀</a>
      <div class="year" id="yearLabel">—</div>
      <a id="yearNext" href="#" aria-label="다음 연도">▶</a>
    </nav>
    <!-- 1~12월 링크 -->
    <div class="months" id="months"></div>

    <!-- 달력 -->
    <section class="cal">
      <div class="head">
        <div>일</div><div>월</div><div>화</div><div>수</div><div>목</div><div>금</div><div>토</div>
      </div>
      <div id="grid" class="grid" role="grid" aria-label="달력 그리드"></div>
    </section>
  </div>

<script>
(function(){
  // ===== helpers =====
  const U = new URL(location.href);
  const lang = (U.searchParams.get('lang')||'ko').toLowerCase();
  const YEAR = +(U.searchParams.get('y')||U.searchParams.get('year')) || new Date().getFullYear();
  const MONTH = +(U.searchParams.get('m')||U.searchParams.get('month')) || (new Date().getMonth()+1);

  const grid = document.getElementById('grid');
  const yearLabel = document.getElementById('yearLabel');
  const yearPrev = document.getElementById('yearPrev');
  const yearNext = document.getElementById('yearNext');
  const monthsBar = document.getElementById('months');

  function linkTo(y, m){
    const u = new URL(location.href);
    u.search = '';
    u.searchParams.set('lang', lang);
    u.searchParams.set('y', y);
    u.searchParams.set('m', m);
    return u.toString();
  }
  function daysInMonth(y, m){ return new Date(y, m, 0).getDate(); }
  function startWeekday(y, m){ return new Date(y, m-1, 1).getDay(); }

  // ===== top bars =====
  yearLabel.textContent = `${YEAR}년`;
  yearPrev.href = linkTo(YEAR-1, MONTH);
  yearNext.href = linkTo(YEAR+1, MONTH);
  monthsBar.innerHTML = '';
  for(let mm=1; mm<=12; mm++){
    const a=document.createElement('a');
    a.href = linkTo(YEAR, mm);
    a.textContent = `${mm}월`;
    if(mm===MONTH) a.classList.add('active');
    monthsBar.appendChild(a);
  }

  // ===== data loader =====
  async function loadData(y, m){
    const file = `data/${y}-${String(m).padStart(2,'0')}.txt`;
    try{
      const res = await fetch(file, {cache:'no-store'});
      if(!res.ok) throw new Error(res.status);
      const txt = await res.text();
      const map={};
      txt.split(/\r?\n/).forEach(line=>{
        const s=line.trim();
        if(!s || s.startsWith('#')) return;
        const p=s.split('|').map(v=>v.trim());
        const d=+p[0]; if(!Number.isInteger(d)) return;
        const title=p[1]||'';
        // p[2]는 부제(사용 안 함)
        const firstLink=p[3]||''; // 제목에만 링크
        map[d]={title, href:firstLink};
      });
      return map;
    }catch(e){ console.warn('데이터 불러오기 실패:', e); return {}; }
  }

  // ===== cell factory =====
  function makeCell(day, entry){
    const div=document.createElement('div');
    div.className='day';
    if(day==null){ div.classList.add('empty'); return div; }

    const d=document.createElement('div'); d.className='date'; d.textContent=String(day);
    div.appendChild(d);

    if(entry && entry.title){
      const t=document.createElement('div'); t.className='title';
      if(entry.href){
        const a=document.createElement('a'); a.href=entry.href; a.target='_blank'; a.rel='noopener'; a.textContent=entry.title;
        t.appendChild(a);
      }else{ t.textContent=entry.title; }
      div.appendChild(t);
    }
    return div;
  }

  // ===== render =====
  (async function render(){
    const total=daysInMonth(YEAR, MONTH);
    const start=startWeekday(YEAR, MONTH);
    const data=await loadData(YEAR, MONTH);

    grid.innerHTML='';
    const cells=Math.ceil((start+total)/7)*7;
    for(let i=0;i<cells;i++){
      const day=(i>=start && (i-start)<total)?(i-start+1):null;
      grid.appendChild(makeCell(day, day? data[day] : null));
    }
  })();
})();
</script>
</body>
</html>
