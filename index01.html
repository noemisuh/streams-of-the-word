<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>말씀따라 흐르는 샘물 · 달력</title>
  <meta name="color-scheme" content="light dark" />
  <style>
    :root{
      --fg:#111827; --muted:#6b7280; --line:#e5e7eb; --line-strong:#cbd5e1;
      --bg:#ffffff; --bgsoft:#f8fafc; --box:#ffffff; --tint:#f0f9ff; --accent:#0ea5e9;
    }
    @media (prefers-color-scheme: dark){
      :root{ --fg:#e5e7eb; --muted:#9ca3af; --line:#1f2937; --line-strong:#374151;
             --bg:#0b0f14; --bgsoft:#0f1720; --box:#0b1220; --tint:#0b1a2a; --accent:#38bdf8; }
    }
    *{box-sizing:border-box}
    body{margin:0;font-family:ui-sans-serif,system-ui,Segoe UI,Apple SD Gothic Neo,Noto Sans KR,Helvetica,Arial,sans-serif;color:var(--fg);background:var(--bgsoft)}
    .wrap{max-width:1080px;margin:24px auto;padding:0 16px}

    /* 연도/월 네비 - 요청한 스타일 */
    .yearbar{display:flex;align-items:center;justify-content:center;gap:16px;margin-bottom:8px}
    .yearbar a{appearance:none;border:1px solid var(--line);background:var(--box);color:var(--fg);
      padding:6px 12px;border-radius:999px;text-decoration:none;font-weight:700}
    .year{font-weight:900;letter-spacing:.02em}

    .months{display:flex;flex-wrap:wrap;gap:8px;justify-content:center;margin-bottom:16px}
    .months a{border:1px solid var(--line);background:var(--box);padding:6px 10px;border-radius:10px;text-decoration:none;color:var(--fg)}
    .months a.active{outline:2px solid var(--accent)}

    .cal{background:var(--box);border:1px solid var(--line);border-radius:14px;overflow:hidden}
    .cal .head{display:grid;grid-template-columns:repeat(7,1fr);border-bottom:1px solid var(--line-strong);background:var(--tint)}
    .cal .head div{padding:10px 8px;text-align:center;font-weight:700}
    .cal .grid{display:grid;grid-template-columns:repeat(7,1fr)}

    .day{min-height:120px;border-right:1px solid var(--line);border-bottom:1px solid var(--line);padding:10px 10px 12px;display:flex;flex-direction:column;gap:8px;transition:background .15s ease}
    .day:nth-child(7n){border-right:none}
    .day:hover{background:color-mix(in oklab, var(--tint) 30%, transparent)}
    .date{font-weight:800;font-size:13px;opacity:.95}
    .date a{color:inherit;text-decoration:none;display:inline-block;padding:2px 6px;border:1px solid var(--line);border-radius:8px;background:color-mix(in oklab, var(--tint) 55%, transparent)}
    .date a:hover{filter:brightness(0.96)}
    .title a{font-size:14px;line-height:1.3;text-decoration:none;color:inherit;display:block;overflow:hidden;text-overflow:ellipsis;-webkit-line-clamp:2; display:-webkit-box; -webkit-box-orient:vertical;font-weight:700}
    .empty{background:linear-gradient(180deg, color-mix(in oklab, var(--tint) 35%, transparent), transparent)}
    .titleCard{margin-top:2px;border:1px solid var(--line);background:color-mix(in oklab, var(--bg) 70%, var(--tint) 30%);border-radius:10px;padding:8px 10px;box-shadow:0 1px 0 color-mix(in oklab, var(--line) 80%, transparent)}
    .titleCard:hover{filter:brightness(0.98)}
    .today{outline:2px solid var(--accent); outline-offset:-2px; background:color-mix(in oklab, var(--tint) 45%, transparent)}

    @media (max-width:720px){ .day{min-height:96px} .title a{font-size:13px} }
  .brand{display:flex;align-items:center;gap:10px;margin:2em 0 10px}
    .brand .dot{width:12px;height:12px;border-radius:999px;background:var(--accent);box-shadow:0 0 0 4px color-mix(in oklab, var(--accent) 20%, transparent)}
    .title-site{margin:0;font-weight:900;letter-spacing:.02em}

    .yearbar{margin-top:8px}

    .day{min-height:120px;border-right:1px solid var(--line);border-bottom:1px solid var(--line);padding:10px 10px 12px;display:flex;flex-direction:column;gap:8px;transition:background .15s ease}
    .day:nth-child(7n){border-right:none}
    .day:hover{background:color-mix(in oklab, var(--tint) 30%, transparent)}
    .date{font-weight:800;font-size:13px;opacity:.95}
    .title a{font-size:28px;line-height:1.25;text-decoration:none;color:inherit;display:block;overflow:hidden;text-overflow:ellipsis;-webkit-line-clamp:2; display:-webkit-box; -webkit-box-orient:vertical;font-weight:800}
    .empty{background:linear-gradient(180deg, color-mix(in oklab, var(--tint) 35%, transparent), transparent)}
    .today{outline:2px solid var(--accent); outline-offset:-2px; background:color-mix(in oklab, var(--tint) 45%, transparent)}

    @media (max-width:720px){ .day{min-height:96px} .title a{font-size:22px} }
    
   <!-- 보정용 스타일: 크기·여백·톤 즉시 조정 -->
<style id="tune">
  /* === 원하는 느낌대로 숫자만 바꿔도 됩니다 === */
  :root{
    --title-size:18px;     /* 날짜 제목 글자 크기 (데스크탑) */
    --title-size-sm:16px;  /* 제목 크기 (모바일)       */
    --card-pad:10px;       /* 제목 박스 안쪽 여백       */
    --card-radius:10px;    /* 제목 박스 둥글기          */
    --card-bg:rgba(0,0,0,.03); /* 제목 박스 배경 톤   */
    --card-border:#e5e7eb; /* 제목 박스 테두리 색       */
    --date-chip-pad:2px 6px;  /* 날짜 칩 패딩          */
    --cell-min:120px;      /* 각 칸 최소 높이           */
  }

  /* 모바일(폭 720px 이하) 튜닝 */
  @media (max-width:720px){
    :root{ --title-size:var(--title-size-sm); --cell-min:96px; }
  }

  /* 실제 적용 (기존 스타일을 부드럽게 덮어써요) */
  .titleCard{
    padding:var(--card-pad) !important;
    border-radius:var(--card-radius) !important;
    background:var(--card-bg) !important;
    border:1px solid var(--card-border) !important;
    box-shadow:0 1px 0 rgba(0,0,0,.05);
    margin-top:4px; /* 제목 박스 위 여백 살짝 */
  }
  .titleCard .title a{
    font-size:var(--title-size) !important;
    line-height:1.3 !important;
    font-weight:700 !important;
    text-decoration:none !important;
    display:block; overflow:hidden; text-overflow:ellipsis;
  }
  .day{ min-height:var(--cell-min) !important; gap:8px !important; }
  .date a{
    display:inline-block; padding:var(--date-chip-pad) !important;
    border:1px solid var(--card-border) !important;
    border-radius:8px !important; text-decoration:none !important; color:inherit !important;
    background:rgba(0,0,0,.03);
  }
  .yearbar a, .months a{ border-radius:12px !important; padding:6px 10px !important; }
</style>
 
  </style>
</head>
<body>
  <div class="wrap">
    <header class="brand">
      <span class="dot" aria-hidden="true"></span>
      <h1 class="title-site">말씀따라 흐르는 샘물</h1>
    </header>
    <!-- 상단: 연도 좌우 화살표 + 현재 연도 라벨 -->
    <nav class="yearbar" aria-label="연도 네비게이션">
      <a id="yearPrev" href="#" aria-label="이전 연도">◀</a>
      <div class="year" id="yearLabel">—</div>
      <a id="yearNext" href="#" aria-label="다음 연도">▶</a>
    </nav>
    <!-- 1~12월 링크 -->
    <div class="months" id="months"></div>

    <!-- 달력 -->
    <section class="cal">
      <div class="head">
        <div>일</div><div>월</div><div>화</div><div>수</div><div>목</div><div>금</div><div>토</div>
      </div>
      <div id="grid" class="grid" role="grid" aria-label="달력 그리드"></div>
    </section>
  </div>

 <script type="text/javascript">
(function(){
  // ===== URL =====
  var u=new URL(location.href);
  var Y=+(u.searchParams.get('y')||u.searchParams.get('year'))||(new Date()).getFullYear();
  var M=+(u.searchParams.get('m')||u.searchParams.get('month'))||((new Date()).getMonth()+1);
  var lang=(u.searchParams.get('lang')||'ko').toLowerCase();

  // ===== 유틸 =====
  function pad2(n){return(n<10?'0':'')+n}
  function looksUrl(s){return !!s&&(s.indexOf('http://')===0||s.indexOf('https://')===0)}
  function linkTo(y,m){
    // 현재 경로 그대로 유지(404 방지). 쿼리만 교체.
    var x=new URL(location.href);
    x.search=''; x.searchParams.set('lang',lang); x.searchParams.set('y',y); x.searchParams.set('m',m);
    return x.toString();
  }
  function daysInMonth(y,m){return new Date(y,m,0).getDate()}
  function startWeekday(y,m){return new Date(y,m-1,1).getDay()}

  // ===== 요소 확보/생성 =====
  var yearbar=document.querySelector('.yearbar');
  var yearLabel=document.getElementById('yearLabel');
  var yearPrev=document.getElementById('yearPrev');
  var yearNext=document.getElementById('yearNext');

  var monthsBar=document.getElementById('months');
  if(!monthsBar){
    // 없으면 yearbar 다음에 생성
    monthsBar=document.createElement('div');
    monthsBar.id='months';
    monthsBar.className='months';
    if(yearbar && yearbar.parentNode){
      yearbar.parentNode.insertBefore(monthsBar, yearbar.nextSibling);
    }else{
      document.body.insertBefore(monthsBar, document.body.firstChild);
    }
  }

  // 달력 그리드 컨테이너
  var grid=document.getElementById('grid')||
            document.querySelector('[data-cal-grid]')||
            document.querySelector('.calendar-grid')||
            document.querySelector('.grid');

  // 없으면 .cal 섹션을 찾고 그 안에 만들어줌
  if(!grid){
    var cal=document.querySelector('.cal');
    if(!cal){
      // 요일 헤더가 있다면 그 바로 아래에 생성
      var head=document.querySelector('.cal .head')||document.querySelector('.head');
      if(head && head.parentNode){
        grid=document.createElement('div'); grid.id='grid'; grid.className='grid';
        head.parentNode.appendChild(grid);
      }
    }else{
      grid=document.createElement('div'); grid.id='grid'; grid.className='grid';
      cal.appendChild(grid);
    }
  }

  // ===== 상단 바 세팅 =====
  if(yearLabel) yearLabel.textContent=Y+'년';  // '—' 방지
  if(yearPrev)  yearPrev.href=linkTo(Y-1,M);
  if(yearNext)  yearNext.href=linkTo(Y+1,M);

  // 월 링크 바 세팅(없으면 자동 생성됨)
  if(monthsBar){
    monthsBar.innerHTML='';
    for(var mm=1;mm<=12;mm++){
      var a=document.createElement('a');
      a.href=linkTo(Y,mm); a.textContent=mm+'월';
      if(mm===M) a.classList.add('active');
      monthsBar.appendChild(a);
    }
  }

  // ===== 스타일 주입(최소) =====
  (function(){
    var css=""
    +".titleCard{margin-top:2px;border:1px solid #e5e7eb;background:rgba(0,0,0,.03);border-radius:10px;padding:8px 10px;box-shadow:0 1px 0 rgba(0,0,0,.05)}"
    +".titleCard .title a{font-size:18px;line-height:1.3;text-decoration:none;color:inherit;display:block;overflow:hidden;text-overflow:ellipsis}"
    +"@media (max-width:720px){.titleCard .title a{font-size:16px}}"
    +".date a{color:inherit;text-decoration:none;display:inline-block;padding:2px 6px;border:1px solid #e5e7eb;border-radius:8px;background:rgba(0,0,0,.03)}";
    var s=document.createElement('style'); s.textContent=css; document.head.appendChild(s);
  })();

  // ===== 숫자 그리드 강제 생성 =====
  function ensureGrid(){
    if(!grid) return;
    // 이미 날짜 셀 있으면 스킵
    if(grid.querySelector('.day')) return;

    var total=daysInMonth(Y,M), start=startWeekday(Y,M);
    grid.innerHTML='';
    var cells=Math.ceil((start+total)/7)*7;
    var today=new Date(), isThis=(today.getFullYear()===Y)&&((today.getMonth()+1)===M);

    for(var i=0;i<cells;i++){
      var day=(i>=start&&(i-start)<total)?(i-start+1):null;
      var cell=document.createElement('div'); cell.className='day';
      if(day===null){ cell.classList.add('empty'); }
      else{
        var d=document.createElement('div'); d.className='date'; d.textContent=String(day); cell.appendChild(d);
        if(isThis && day===today.getDate()) cell.classList.add('today');
      }
      grid.appendChild(cell);
    }
  }

  // ===== 데이터 로드 =====
  function loadData(y,m,done){
    var fname=y+"-"+pad2(m)+".txt";
    // 현재 문서 경로를 유지하면서 상대경로 우선
    var candidates=[
      "data/"+fname,
      "../data/"+fname,
      "../../data/"+fname
    ];
    var parts=location.pathname.split('/').filter(function(v){return !!v});
    if(parts.length>=1) candidates.push("/"+parts[0]+"/data/"+fname);

    var i=0;
    function next(){
      if(i>=candidates.length){ done({}); return; }
      var url=candidates[i++];
      fetch(url,{cache:"no-store"}).then(function(res){
        if(!res.ok) throw new Error("HTTP "+res.status);
        return res.text();
      }).then(function(txt){
        // 줄 나누기(\r 제거)
        var arr=txt.split("\n"), lines=[], k, line;
        for(k=0;k<arr.length;k++){ line=arr[k]; if(line && line.length && line.charCodeAt(line.length-1)===13) line=line.slice(0,-1); lines.push(line); }
        var map={}, j, L, p, t;
        for(j=0;j<lines.length;j++){
          L=(lines[j]||"").trim(); if(!L||L.charAt(0)==="#") continue;
          p=L.split("|"); for(t=0;t<p.length;t++){ p[t]=(p[t]||"").trim(); }
          var day=parseInt(p[0],10); if(!day||isNaN(day)) continue;
          var title=p[1]||"";
          var first=""; if(p.length>=4){ first=p[3]; } else if(p.length>=3 && looksUrl(p[2])){ first=p[2]; }
          var second=p[4]||"";
          var href=looksUrl(first)?first:(looksUrl(second)?second:"");
          map[day]={title:title, href:href};
        }
        done(map);
      }).catch(function(){ next(); });
    }
    next();
  }

  // ===== 제목/링크 꽂기 =====
  function fill(map){
    if(!grid) return;
    var cells=grid.querySelectorAll('.day');
    for(var i=0;i<cells.length;i++){
      var cell=cells[i]; if(cell.classList.contains('empty')) continue;
      var dateEl=cell.querySelector('.date'); if(!dateEl) continue;
      var dd=parseInt(String(dateEl.textContent||'').trim(),10); if(!dd||!map[dd]) continue;
      var info=map[dd];

      // 날짜도 링크
      if(info.href && !dateEl.querySelector('a')){
        var da=document.createElement('a'); da.href=info.href; da.target='_blank'; da.rel='noopener';
        da.textContent=String(dd); dateEl.textContent=''; dateEl.appendChild(da);
      }
      // 제목 카드
      if(info.title){
        var box=cell.querySelector('.titleCard'); if(!box){ box=document.createElement('div'); box.className='titleCard'; cell.appendChild(box); }
        var tDiv=box.querySelector('.title'); if(!tDiv){ tDiv=document.createElement('div'); tDiv.className='title'; box.appendChild(tDiv); }
        tDiv.innerHTML='';
        if(info.href){ var a=document.createElement('a'); a.href=info.href; a.target='_blank'; a.rel='noopener'; a.textContent=info.title; tDiv.appendChild(a); }
        else { tDiv.textContent=info.title; }
      }
    }
  }

  // ===== 실행 =====
  ensureGrid();           // 숫자 칸부터 강제 생성
  loadData(Y,M,function(map){ try{ fill(map||{}); }catch(e){} }); // 제목/링크 채우기
})();
</script>
</body>
</html>
