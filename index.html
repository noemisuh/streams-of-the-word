,306 +1,317 @@
index_html = """<!doctype html>
<!doctype html>
<html lang="ko">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>ë§ì”€ë”°ë¼ íë¥´ëŠ” ìƒ˜ë¬¼</title>
<meta name="color-scheme" content="light dark" />
<style>
  :root{ --fg:#111827; --muted:#6b7280; --line:#e5e7eb; --line-strong:#cbd5e1;
         --accent:#0ea5e9; --bg:#ffffff; --box:#ffffff; --bgsoft:#f8fafc; }
  @media (prefers-color-scheme: dark){
    :root{ --fg:#e5e7eb; --muted:#9ca3af; --line:#334155; --line-strong:#475569;
           --accent:#38bdf8; --bg:#0b0f14; --box:#0f1720; --bgsoft:#0f1720; }
  }
  *{box-sizing:border-box}
  body{
    margin:0;background:var(--bg);color:var(--fg);
    font-family:ui-sans-serif,system-ui,-apple-system,"Segoe UI",Roboto,"Noto Sans KR","Apple SD Gothic Neo","Malgun Gothic",sans-serif;
  }
  /* ìƒë‹¨ ì—¬ë°± 2ì¹¸ + ì œëª© í¬ê¸° ì¶•ì†Œ */
  .wrap{max-width:1080px;margin:0 auto;padding:56px 16px 24px;}
  .top{display:grid;grid-template-rows:40px 36px 40px;row-gap:12px;}
  .brand{display:flex;align-items:center;gap:10px;font-weight:800;letter-spacing:.02em;font-size:18px;}
  .brand .dot{width:10px;height:10px;border-radius:50%;background:var(--accent);}

  .yearbar{display:flex;justify-content:center;align-items:center;gap:16px;}
  .yearbar a{text-decoration:none;padding:6px 10px;border-radius:10px;border:1px solid var(--line-strong);background:var(--box);color:var(--fg);}
  .yearbar .yr{min-width:90px;text-align:center;font-weight:700;border:none;background:transparent;color:var(--fg);}

  .monthbar{display:flex;flex-wrap:wrap;justify-content:center;gap:6px 10px;}
  .monthbar a{text-decoration:none;padding:6px 10px;border-radius:999px;border:1px solid var(--line);color:var(--fg);background:var(--box);}
  .monthbar a.active{border-color:var(--accent);outline:2px solid rgba(56,189,248,.25);}

  /* ë‹¬ë ¥ */
  .cal{margin-top:18px;border:1px solid var(--line-strong);border-radius:14px;overflow:hidden;background:var(--box);}
  .cal .head{display:grid;grid-template-columns:repeat(7,1fr);border-bottom:1px solid var(--line-strong);background:var(--bgsoft);}
  .cal .head div{padding:10px 8px;text-align:center;font-weight:700;color:var(--muted);}
  .grid{display:grid;grid-template-columns:repeat(7,1fr);}
  .cell{border-right:1px solid var(--line);border-bottom:1px solid var(--line);padding:10px;position:relative;}
  .grid .cell:nth-child(7n){border-right:none;}

  /* ì…€ ì „ì²´ ë‘¥ê·¼ì¹¸(ì¤‘ì•™ ë ˆì´ì•„ì›ƒ) */
  .cellbox{
    position:relative;
    display:flex; flex-direction:column;
    width:100%; min-height:140px;
    padding:28px 16px 16px;          /* ë‚ ì§œ ë°°ì§€ì™€ ê°„ê²© í™•ë³´(ìœ„ 28px) */
    border:1px solid var(--line);
    border-radius:14px;
    background:rgba(14,165,233,0.10);
    text-decoration:none; color:inherit;
    transition:box-shadow .15s ease, border-color .15s ease, background .15s ease;
  }
  a.cellbox:hover{ box-shadow:0 2px 10px rgba(0,0,0,.06); border-color:var(--accent); background:rgba(14,165,233,0.14); }

  /* ë‚ ì§œ ë°°ì§€: ì¢Œìƒë‹¨ ê³ ì •, ê²¹ì¹¨ ë°©ì§€ */
  .dnum-badge{
    position:absolute; left:10px; top:10px;
    z-index:3;
    font-size:12px; color:var(--muted);
    padding:2px 6px; border:1px solid var(--line); border-radius:8px;
    background:var(--box);
  }

  /* ì¤‘ì•™ ì˜ì—­: ë‚¨ì€ ê³µê°„ì„ ê°€ë“ ì°¨ì§€í•˜ì—¬ ì¤‘ì•™ì •ë ¬ */
  .center{
    flex:1;
    display:flex; flex-direction:column; align-items:center; justify-content:center;
    text-align:center; padding:6px 4px;
  }

  /* ì œëª©: 2~3ì¤„ ìë™ ì¤„ë°”ê¿ˆ(ìµœëŒ€ 3ì¤„), ê°€ìš´ë° */
  .title-center{
    max-width:100%;
    font-size:16px; line-height:1.4;
    white-space:normal;
    word-break:keep-all;
    overflow:hidden;
    display:-webkit-box;
    -webkit-line-clamp:3;
    -webkit-box-orient:vertical;
    text-wrap:balance;
    margin:0;
  }

  .ref{margin-top:8px;font-size:12px;color:var(--muted);
       white-space:nowrap;overflow:hidden;text-overflow:ellipsis;}
  .more{font-size:11px;color:var(--muted);margin-top:4px;}

  @media (prefers-color-scheme: dark){
    .cellbox{ background:rgba(56,189,248,0.12); }
    .dnum-badge{ background:#0f1720; border-color:#334155; color:#9ca3af; }
  }
</style>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title></title>

  <style>
    :root{
      --bg:#0b1220; --fg:#e5e7eb; --muted:#94a3b8; --brand:#38bdf8;
      --cell-bg:#0f172a; --cell-ring:#334155;
    }
    html,body{margin:0;padding:0;background:#0b1220;color:var(--fg);font:15px/1.5 system-ui,-apple-system,Segoe UI,Roboto,'Noto Sans KR',sans-serif}
    a{color:#cbeafe}
    .wrap{max-width:980px;margin:0 auto;padding:16px 20px 64px}

    /* ê³µí†µ ë„¤ë¹„ê²Œì´ì…˜ */
    .site-nav {background:#0f172a;color:#fff;position:sticky;top:0;z-index:20}
    .site-nav nav{display:flex;flex-wrap:wrap;gap:10px;justify-content:center;align-items:center;padding:12px}
    .site-nav a{color:#fff;text-decoration:none;opacity:.9;padding:4px 6px;border-radius:8px}
    .site-nav a:hover,.site-nav a:focus{opacity:1;text-decoration:underline}
    .site-nav a[aria-current="page"]{opacity:1;background:rgba(255,255,255,.12)}
    .site-nav .sep{opacity:.35}

    /* ì œëª©ì´ ì•ˆ ë³´ì´ëŠ” ìŠ¤í‚¨ì„ ë¬´ë ¥í™” */
    h1#page-title, h1.page-title{
      display:block !important; margin:24px 0 12px !important;
      font-weight:800; font-size:clamp(22px,2.4vw,30px);
      line-height:1.35; white-space:normal !important;
      overflow:visible !important; text-overflow:clip !important;
      height:auto !important; max-height:none !important;
    }
    .topbar, .header, #title-wrap{ overflow:visible !important; height:auto !important; }

    /* ìƒë‹¨ ì»¨íŠ¸ë¡¤ */
    .controls{display:flex;align-items:center;gap:10px;flex-wrap:wrap;margin:10px 0 16px}
    .controls button{background:#0f172a;color:#e5e7eb;border:1px solid #334155;border-radius:10px;padding:6px 10px;cursor:pointer}
    .controls button:hover{border-color:#4b5563}
    #monthbar a{display:inline-block;margin-right:6px;padding:4px 8px;border-radius:8px;color:#e5e7eb;text-decoration:none;border:1px solid transparent}
    #monthbar a.active{background:#0f172a;border-color:#334155}

    /* ë‹¬ë ¥ ê·¸ë¦¬ë“œ */
    .calendar-grid{
      display:grid; gap:10px;
      grid-template-columns: repeat(7, 1fr);
    }
    .cell{min-height:92px}
    .cellbox{
      display:block; height:100%;
      background:#0f172a; border:1px solid var(--cell-ring); border-radius:14px;
      padding:12px; text-decoration:none; color:inherit; position:relative;
    }
    .dnum-badge{
      position:absolute; top:8px; left:10px;
      min-width:26px; height:26px; border-radius:8px;
      background:#0b1220; border:1px solid var(--cell-ring);
      color:#9ca3af; font-size:12px; display:flex; align-items:center; justify-content:center;
    }
    .center{display:flex; flex-direction:column; align-items:center; justify-content:center; height:100%; text-align:center}
    .title-center{font-weight:700}
    .ref{margin-top:4px; font-size:12px; color:#9ca3af}

    @media (prefers-color-scheme: light){
      html,body{background:#fafafa;color:#111827}
      .site-nav{background:#0f172a;color:#fff}
      .cellbox{background:#ffffff;border-color:#e5e7eb}
      .dnum-badge{background:#f3f4f6;border-color:#e5e7eb;color:#4b5563}
      #monthbar a{color:#111827}
      #monthbar a.active{background:#f3f4f6;border-color:#d1d5db}
    }
    @media (prefers-color-scheme: dark){
      .cellbox{ background:rgba(56,189,248,0.08); }
      .dnum-badge{ background:#0f1720; border-color:#334155; color:#9ca3af; }
    }
  </style>
</head>
<body>
<!-- â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ ê³µí†µ ë„¤ë¹„ê²Œì´ì…˜(ì¶”ê°€) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
<header style="background:#0f172a;color:white;padding:12px;text-align:center;font-family:system-ui,-apple-system,Segoe UI,Roboto,'Noto Sans KR',sans-serif;position:relative;z-index:10;">
  <nav style="display:flex;flex-wrap:wrap;gap:8px;justify-content:center;">
    <a href="https://noemisuh.github.io/faith-scripture/" style="color:#fff;text-decoration:none;opacity:.9;">ë¯¿ìŒìœ¼ë¡œ ì“°ëŠ” ì„±ê²½</a>
    <span aria-hidden="true" style="opacity:.35;">|</span>
    <a href="https://noemisuh.github.io/faith-bible-copy/" style="color:#fff;text-decoration:none;opacity:.9;">í•„ì‚¬ ì„±ê²½</a>
    <span aria-hidden="true" style="opacity:.35;">|</span>
    <a href="https://noemisuh.github.io/streams-of-the-word/" style="color:#fff;text-decoration:none;opacity:.9;">ë§ì”€ë”°ë¼ íë¥´ëŠ” ìƒ˜ë¬¼</a>
    <!-- ğŸ”¹ ì—¬ê¸° êµ¬ë¶„ì„  ì¶”ê°€ -->
    <span aria-hidden="true" style="opacity:.35;">|</span>
    <!-- ğŸ”¹ ìƒˆ í•­ëª©: ê¸°ì¡´ ì¹´í…Œê³ ë¦¬ì™€ ë™ì¼ ìŠ¤íƒ€ì¼ -->
    <a href="https://noemisuh.github.io/streams-of-the-word/poem-confession/" style="color:#fff;text-decoration:none;opacity:.9;">ì‹œì™€ ê³ ë°±</a>
  </nav>
</header>
  <!-- â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ ê³µí†µ ë„¤ë¹„ê²Œì´ì…˜(ë) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
  <!-- ê³µí†µ ë„¤ë¹„ -->
  <header class="site-nav" role="navigation" aria-label="ì‚¬ì´íŠ¸ ê³µí†µ ë©”ë‰´">
    <nav>
      <a href="https://noemisuh.github.io/faith-scripture/">ë¯¿ìŒìœ¼ë¡œ ì“°ëŠ” ì„±ê²½</a>
      <span class="sep" aria-hidden="true">|</span>
      <a href="https://noemisuh.github.io/faith-bible-copy/">í•„ì‚¬ ì„±ê²½</a>
      <span class="sep" aria-hidden="true">|</span>
      <a href="https://noemisuh.github.io/streams-of-the-word/">ë§ì”€ë”°ë¼ íë¥´ëŠ” ìƒ˜ë¬¼</a>
      <span class="sep" aria-hidden="true">|</span>
      <a href="https://noemisuh.github.io/streams-of-the-word/poem-confession/">ì‹œì™€ ê³ ë°±</a>
    </nav>
  </header>

  <div class="wrap">
    <section class="top" aria-label="ìƒë‹¨">
      <div class="brand"><span class="dot" aria-hidden="true"></span><span>ë§ì”€ë”°ë¼ íë¥´ëŠ” ìƒ˜ë¬¼</span></div>
      <nav class="yearbar" aria-label="ë…„ë„">
        <!-- onclick ì „ì—­ í•¨ìˆ˜ë¡œ ê°•ì œ ì´ë™ (index ìœ ë¬´ ë¬´ê´€) -->
        <a id="prevYear" href="#" onclick="goYear(-1);return false;">â—€</a>
        <span class="yr" id="yearLabel">0000</span>
        <a id="nextYear" href="#" onclick="goYear(1);return false;">â–¶</a>
      </nav>
      <nav class="monthbar" id="monthbar" aria-label="ì›”"></nav>
    </section>

    <section class="cal" aria-label="ë‹¬ë ¥">
      <div class="head"><div>ì¼</div><div>ì›”</div><div>í™”</div><div>ìˆ˜</div><div>ëª©</div><div>ê¸ˆ</div><div>í† </div></div>
      <div id="grid" class="grid" role="grid" aria-label="ë‹¬ë ¥ ê·¸ë¦¬ë“œ"></div>
    </section>
    <header id="title-wrap">
      <h1 id="page-title" class="page-title"></h1>
    </header>

    <div class="controls" aria-label="ì—°ë„/ì›” ì´ë™">
      <button id="prevYear" type="button" aria-label="ì´ì „ í•´">Â«</button>
      <strong id="yearLabel"></strong>
      <button id="nextYear" type="button" aria-label="ë‹¤ìŒ í•´">Â»</button>
      <nav id="monthbar" aria-label="ì›” ì„ íƒ"></nav>
    </div>

    <div id="grid" class="calendar-grid" aria-live="polite"></div>
  </div>

  <script>
(function(){
  // --- URL íŒŒë¼ë¯¸í„° (y, m). ì˜ëª»ë˜ë©´ ì˜¤ëŠ˜ ê¸°ì¤€ ---
  var u = new URL(location.href);
  var now = new Date();
  var y = parseInt(u.searchParams.get('y') || now.getFullYear(), 10);
  var m = parseInt(u.searchParams.get('m') || (now.getMonth()+1), 10);
  if(!(y>=1900 && y<=9999)) y = now.getFullYear();
  if(!(m>=1 && m<=12)) m = now.getMonth()+1;
  var mm = String(m).padStart(2,'0');

  // --- ì—°/ì›” ì´ë™ ---
  function go(y2,m2){
    var nu = new URL(location.href);
    nu.searchParams.set('y', String(y2));
    nu.searchParams.set('m', String(m2));
    var currLang = (u.searchParams.get('lang') || 'ko').toLowerCase();
    nu.searchParams.set('lang', currLang); 
    nu.searchParams.set('v', Date.now()); // ìºì‹œë²„ìŠ¤í„°
    location.href = nu.toString();
  }
  window.goYear = function(delta){ go(y+delta, m); };

  // --- ìƒë‹¨ UI ì„¸íŒ… ---
  var yLabel = document.getElementById('yearLabel');
  if (yLabel) yLabel.textContent = y;

  var prev = document.getElementById('prevYear');
  var next = document.getElementById('nextYear');
  if (prev) prev.onclick = function(e){ e.preventDefault(); go(y-1, m); };
  if (next) next.onclick = function(e){ e.preventDefault(); go(y+1, m); };

  var mbar  = document.getElementById('monthbar');
  if (mbar){
    mbar.innerHTML = '';
    for(var i=1;i<=12;i++){
      (function(ii){
        var a = document.createElement('a');
        a.href = '#'; a.textContent = ii + 'ì›”';
        if(ii===m) a.className = 'active';
        a.onclick = function(e){ e.preventDefault(); go(y, ii); };
        mbar.appendChild(a);
      })(i);
  (function(){
    // ===== ê¸°ë³¸ ì„¤ì • (ì›í•˜ë©´ ìˆ˜ì •) =====
    var DEFAULT_Y = 2025;   // íŒŒë¼ë¯¸í„°/í•´ì‹œ ì—†ì„ ë•Œ ê¸°ë³¸ ì—°ë„
    var DEFAULT_M = 10;     // íŒŒë¼ë¯¸í„°/í•´ì‹œ ì—†ì„ ë•Œ ê¸°ë³¸ ì›”

    // --- URL/í•´ì‹œ íŒŒì‹± ---
    var u = new URL(location.href);
    var now = new Date();
    var hash = (location.hash || '').replace('#','').trim(); // "2025-10"
    var hashYm = hash.match(/^(\d{4})-(0[1-9]|1[0-2])$/);

    var hasY = u.searchParams.has('y');
    var hasM = u.searchParams.has('m');

    var y = parseInt(hasY ? u.searchParams.get('y') : (hashYm ? hashYm[1] : (DEFAULT_Y || now.getFullYear())), 10);
    var m = parseInt(hasM ? u.searchParams.get('m') : (hashYm ? hashYm[2] : (DEFAULT_M || (now.getMonth()+1))), 10);

    if(!(y>=1900 && y<=9999)) y = now.getFullYear();
    if(!(m>=1 && m<=12))      m = now.getMonth()+1;
    var mm = String(m).padStart(2,'0');

    // --- ì—°/ì›” ì´ë™ ---
    function go(y2,m2){
      var nu = new URL(location.href);
      nu.searchParams.set('y', String(y2));
      nu.searchParams.set('m', String(m2));

      var currLang = (u.searchParams.get('lang') || 'ko').toLowerCase();
      nu.searchParams.set('lang', currLang);
      var currTarget = (u.searchParams.get('target') || '').toLowerCase();
      if (currTarget) nu.searchParams.set('target', currTarget);

      nu.searchParams.set('v', Date.now()); // ìºì‹œë²„ìŠ¤í„°
      location.href = nu.toString();
    }
  }

  // --- ë°ì´í„° ë¡œë”©(ì—†ì–´ë„ ì¡°ìš©íˆ ì§€ë‚˜ê°) ---
  var dayMap = Object.create(null);
  function parseText(t){
    if(!t) return;
    if(t.charCodeAt && t.charCodeAt(0)===0xFEFF) t = t.slice(1); // BOM ì œê±°
    var lines = t.replace(/\r\n?/g,'\n').split('\n');
    for(var i=0;i<lines.length;i++){
      var line = lines[i].trim(); if(!line) continue;
      var parts = line.split('|').map(function(s){ return s.trim(); });
      if(parts.length < 3) continue; // DD|ì œëª©|ë§í¬  ë˜ëŠ” DD|ì œëª©|ë³¸ë¬¸ì•½ì|ë§í¬
      var d = parseInt(parts[0],10); if(!(d>=1 && d<=31)) continue;
      var title = parts[1] || '';
      var ref   = (parts.length>=4 ? parts[2] : '');
      var href  = (parts.length>=4 ? parts[3] : parts[2]) || '';
      dayMap[d] = {title:title, ref:ref, href:href};
    window.goYear = function(delta){ go(y+delta, m); };

    // --- ìƒë‹¨ UI ì„¸íŒ… ---
    var yLabel = document.getElementById('yearLabel');
    if (yLabel) yLabel.textContent = y;

    var prev = document.getElementById('prevYear');
    var next = document.getElementById('nextYear');
    if (prev) prev.onclick = function(e){ e.preventDefault(); go(y-1, m); };
    if (next) next.onclick = function(e){ e.preventDefault(); go(y+1, m); };

    var mbar  = document.getElementById('monthbar');
    if (mbar){
      mbar.innerHTML = '';
      for(var i=1;i<=12;i++){
        (function(ii){
          var a = document.createElement('a');
          a.href = '#'; a.textContent = ii + 'ì›”';
          if(ii===m) a.className = 'active';
          a.onclick = function(e){ e.preventDefault(); go(y, ii); };
          mbar.appendChild(a);
        })(i);
      }
    }
  }

<!-- [ADD ONLY] í”Œë«í¼ ê°ì§€ + ë§í¬ ë§¤í•‘ -->
  var PLATFORM = (u.searchParams.get('target') || '').toLowerCase();
  if(!PLATFORM){
    var host = location.hostname;
    if(host.indexOf('naver.com') > -1) PLATFORM = 'naver';
    else if(host.indexOf('tistory.com') > -1) PLATFORM = 'tistory';
    else PLATFORM = 'web';
  }

  var linkMap = Object.create(null);
  function loadLinkMap(){
    return fetch('data/links-map.txt?v=' + Date.now(), {cache:'no-store'})
      .then(function(r){ return r.ok ? r.text() : ''; })
      .then(function(t){
        if(!t) return;
        if(t.charCodeAt && t.charCodeAt(0)===0xFEFF) t = t.slice(1);
        t.replace(/\r\n?/g,'\n').split('\n').forEach(function(line){
          line = (line||'').trim();
          if(!line || line[0]==='#') return;
          var p = line.split('|').map(function(s){return s.trim();});
          if(p.length < 2) return;
          linkMap[p[0]] = p[1];
        });
      })
      .catch(function(){});
  }

  function getHref(original){
    if(!original) return '';
    if(PLATFORM === 'naver' && linkMap[original]) return linkMap[original];
    return original;
  }
  
  // --- ë Œë” ---
  function render(){
    var grid = document.getElementById('grid'); if(!grid) return;
    grid.innerHTML = '';

    var first = new Date(y, m-1, 1);
    var start = first.getDay();
    var days  = new Date(y, m, 0).getDate();

    var cells = [];
    for(var s=0;s<start;s++) cells.push({empty:true});
    for(var d=1; d<=days; d++) cells.push({empty:false, d:d, info:dayMap[d]});
    while(cells.length % 7 !== 0) cells.push({empty:true});

    cells.forEach(function(c){
      var cell = document.createElement('div');
      cell.className = 'cell';
      if(c.empty){ grid.appendChild(cell); return; }

      var info = c.info;
      var box = (info && info.href) ? document.createElement('a') : document.createElement('div');
      box.className = 'cellbox';  
      var finalHref = info ? getHref(info.href) : '';
      if(finalHref){ box.href = finalHref; box.target = '_blank'; box.rel='noopener'; }

      var badge = document.createElement('div'); badge.className = 'dnum-badge'; badge.textContent = c.d; box.appendChild(badge);

      var center = document.createElement('div'); center.className = 'center';
      var titleEl = document.createElement('div'); titleEl.className = 'title-center';
      titleEl.textContent = (info && info.title) ? info.title : ''; center.appendChild(titleEl);
      if(info && info.ref){ var r = document.createElement('div'); r.className='ref'; r.textContent = info.ref; center.appendChild(r); }

      box.appendChild(center); cell.appendChild(box); grid.appendChild(cell);
    });
  }

  // --- ì‹œì‘ ---
  function load(){
    var url = 'data/' + y + '-' + mm + '.txt';
    fetch(url, {cache:'no-store'})
      .then(function(r){ return r.ok ? r.text() : ''; })
      .then(function(t){ parseText(t); render(); })
      .catch(function(){ render(); });
  }
  /* === [ADD ONLY] ì–¸ì–´ë³„ ë°ì´í„° ìš°ì„  ë¡œë”© ===
     ë¶™ì—¬ë„£ê¸° ìœ„ì¹˜: ë°”ë¡œ ì•„ë˜ì˜ load(); í˜¸ì¶œ "ì§ì „" */
  var lang = (u.searchParams.get('lang') || 'ko').toLowerCase();

  // ê¸°ì¡´ parseText / render ê·¸ëŒ€ë¡œ ì‚¬ìš©
  function load(){
    var baseUrl = 'data/' + y + '-' + mm + '.txt';
    var langUrl = 'data/' + y + '-' + mm + '.' + lang + '.txt';

    // --- ë°ì´í„° íŒŒì„œ ---
    var dayMap = Object.create(null);
    function parseText(t){
      if(!t) return;
      if(t.charCodeAt && t.charCodeAt(0)===0xFEFF) t = t.slice(1); // BOM ì œê±°
      var lines = t.replace(/\r\n?/g,'\n').split('\n');
      for(var i=0;i<lines.length;i++){
        var line = lines[i].trim(); if(!line) continue;
        var parts = line.split('|').map(function(s){ return s.trim(); });
        // DD|ì œëª©|ë§í¬  ë˜ëŠ”  DD|ì œëª©|ë³¸ë¬¸ì•½ì|ë§í¬
        if(parts.length < 3) continue;
        var d = parseInt(parts[0],10); if(!(d>=1 && d<=31)) continue;
        var title = parts[1] || '';
        var ref   = (parts.length>=4 ? parts[2] : '');
        var href  = (parts.length>=4 ? parts[3] : parts[2]) || '';
        dayMap[d] = {title:title, ref:ref, href:href};
      }
    }

    // --- í”Œë«í¼ ê°ì§€ + ë§í¬ ë§¤í•‘ ---
    var PLATFORM = (u.searchParams.get('target') || '').toLowerCase();
    if(!PLATFORM){
      var host = location.hostname;
      if(host.indexOf('naver.com') > -1) PLATFORM = 'naver';
      else if(host.indexOf('tistory.com') > -1) PLATFORM = 'tistory';
      else PLATFORM = 'web';
    }

    var linkMap = Object.create(null);
    function loadLinkMap(){
      return fetch('data/links-map.txt?v=' + Date.now(), {cache:'no-store'})
        .then(function(r){ return r.ok ? r.text() : ''; })
        .then(function(t){
          if(!t) return;
          if(t.charCodeAt && t.charCodeAt(0)===0xFEFF) t = t.slice(1);
          t.replace(/\r\n?/g,'\n').split('\n').forEach(function(line){
            line = (line||'').trim();
            if(!line || line[0]==='#') return;
            var p = line.split('|').map(function(s){return s.trim();});
            if(p.length < 2) return;
            linkMap[p[0]] = p[1];
          });
        })
        .catch(function(){});
    }

    function getHref(original){
      if(!original) return '';
      if(PLATFORM === 'naver' && linkMap[original]) return linkMap[original];
      return original;
    }

    // --- ì œëª© ìë™ ì±„ìš°ê¸° (ë¹„ì–´ ìˆì„ ë•Œë§Œ) ---
    function setPageTitle(yy, mmStr){
      var h1 = document.querySelector('#page-title, h1.page-title, h1');
      var nice = yy + 'ë…„ ' + parseInt(mmStr,10) + 'ì›”';
      if (h1 && !h1.textContent.trim()) h1.textContent = nice;
      if (!document.title || !document.title.trim()) document.title = nice;
    }

    // --- ë Œë” ---
    function render(){
      var grid = document.getElementById('grid'); if(!grid) return;
      grid.innerHTML = '';

      var first = new Date(y, m-1, 1);
      var start = first.getDay();
      var days  = new Date(y, m, 0).getDate();

      var cells = [];
      for(var s=0;s<start;s++) cells.push({empty:true});
      for(var d=1; d<=days; d++) cells.push({empty:false, d:d, info:dayMap[d]});
      while(cells.length % 7 !== 0) cells.push({empty:true});

      cells.forEach(function(c){
        var cell = document.createElement('div');
        cell.className = 'cell';
        if(c.empty){ grid.appendChild(cell); return; }

        var info = c.info;
        var box = (info && info.href) ? document.createElement('a') : document.createElement('div');
        box.className = 'cellbox';

        var finalHref = info ? getHref(info.href) : '';
        if(finalHref){ box.href = finalHref; box.target = '_blank'; box.rel='noopener'; }

        var badge = document.createElement('div');
        badge.className = 'dnum-badge';
        badge.textContent = c.d;
        box.appendChild(badge);

        var center = document.createElement('div');
        center.className = 'center';

        var titleEl = document.createElement('div');
        titleEl.className = 'title-center';
        titleEl.textContent = (info && info.title) ? info.title : '';
        center.appendChild(titleEl);

        if(info && info.ref){
          var r = document.createElement('div');
          r.className='ref';
          r.textContent = info.ref;
          center.appendChild(r);
        }

        box.appendChild(center);
        cell.appendChild(box);
        grid.appendChild(cell);
      });

      // ì œëª© ë³´ì •
      setPageTitle(y, mm);
    }

    // --- ì–¸ì–´ë³„ ë°ì´í„° ìš°ì„  ë¡œë”© ---
    var lang = (u.searchParams.get('lang') || 'ko').toLowerCase();
    function tryFetch(url){
      return fetch(url + '?v=' + Date.now(), {cache:'no-store'})
              .then(function(r){ return r.ok ? r.text() : ''; })
              .catch(function(){ return ''; });
    }
    function load(){
      var baseUrl = 'data/' + y + '-' + mm + '.txt';
      var langUrl = 'data/' + y + '-' + mm + '.' + lang + '.txt';
      return tryFetch(langUrl).then(function(t){
        if(t){ parseText(t); render(); return; }
        return tryFetch(baseUrl).then(function(t2){
          parseText(t2); render();
        });
      }).catch(function(){ render(); });
    }

    // 1) ì–¸ì–´ë³„ íŒŒì¼ ì‹œë„ â†’ 2) ê³µìš© íŒŒì¼ í´ë°± â†’ 3) ë¹„ì–´ë„ ë Œë”
    tryFetch(langUrl).then(function(t){
      if(t){
        parseText(t);
        render();
        return;
      }
      return tryFetch(baseUrl).then(function(t2){
        parseText(t2);
        render();
    // --- ì‹œì‘ ---
    loadLinkMap().then(function(){ return load(); });

    // ê³µí†µ ë„¤ë¹„ í˜„ì¬ í˜ì´ì§€ ê°•ì¡°
    (function(){
      var here = location.href.replace(/\/index\.html?$/,'').replace(/\/$/,'');
      document.querySelectorAll('.site-nav a').forEach(function(a){
        var href = a.href.replace(/\/index\.html?$/,'').replace(/\/$/,'');
        if (here === href || (here.startsWith(href) && href.length>20)) {
          a.setAttribute('aria-current','page');
        }
      });
    }).catch(function(){
      render();
    });
  }
  loadLinkMap().then(function(){ load(); });
})();
</script>
    })();

  })();
  </script>
</body>
</html>
