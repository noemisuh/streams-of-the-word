<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>말씀따라 흐르는 샘물</title>
  <meta name="color-scheme" content="light dark" />

  <style>
    /* ===== 기본 테마(당신이 쓰던 스타일 보존) ===== */
    :root{ --fg:#111827; --muted:#6b7280; --line:#e5e7eb; --line-strong:#cbd5e1;
           --accent:#0ea5e9; --bg:#ffffff; --box:#ffffff; --bgsoft:#f8fafc; }
    @media (prefers-color-scheme: dark){
      :root{ --fg:#e5e7eb; --muted:#9ca3af; --line:#334155; --line-strong:#475569;
             --accent:#38bdf8; --bg:#0b0f14; --box:#0f1720; --bgsoft:#0f1720; }
    }
    *{box-sizing:border-box}
    html,body{margin:0;padding:0;background:var(--bg);color:var(--fg);
      font:15px/1.5 ui-sans-serif,system-ui,-apple-system,"Segoe UI",Roboto,"Noto Sans KR","Apple SD Gothic Neo","Malgun Gothic",sans-serif;}
    a{color:#0ea5e9}

    /* 컨테이너 */
    .wrap{max-width:1080px;margin:0 auto;padding:56px 16px 24px;}

    /* 상단 브랜드/연/월 바 */
    .top{display:grid;grid-template-rows:40px 36px 40px;row-gap:12px;}
    .brand{display:flex;align-items:center;gap:10px;font-weight:800;letter-spacing:.02em;font-size:18px;}
    .brand .dot{width:10px;height:10px;border-radius:50%;background:var(--accent);}

    .yearbar{display:flex;justify-content:center;align-items:center;gap:16px;}
    .yearbar a{text-decoration:none;padding:6px 10px;border-radius:10px;border:1px solid var(--line-strong);background:var(--box);color:var(--fg);}
    .yearbar .yr{min-width:90px;text-align:center;font-weight:700;border:none;background:transparent;color:var(--fg);}

    .monthbar{display:flex;flex-wrap:wrap;justify-content:center;gap:6px 10px;}
    .monthbar a{text-decoration:none;padding:6px 10px;border-radius:999px;border:1px solid var(--line);color:var(--fg);background:var(--box);}
    .monthbar a.active{border-color:var(--accent);outline:2px solid rgba(56,189,248,.25);}

    /* 달력 프레임 */
    .cal{margin-top:18px;border:1px solid var(--line-strong);border-radius:14px;overflow:hidden;background:var(--box);}
    .cal .head{display:grid;grid-template-columns:repeat(7,1fr);border-bottom:1px solid var(--line-strong);background:var(--bgsoft);}
    .cal .head div{padding:10px 8px;text-align:center;font-weight:700;color:var(--muted);}
    .grid{display:grid;grid-template-columns:repeat(7,1fr);}
    .cell{border-right:1px solid var(--line);border-bottom:1px solid var(--line);padding:10px;position:relative;}
    .grid .cell:nth-child(7n){border-right:none;}

    /* 셀 내부 카드 */
    .cellbox{
      position:relative; display:flex; flex-direction:column;
      width:100%; min-height:140px; padding:28px 16px 16px;
      border:1px solid var(--line); border-radius:14px;
      background:rgba(14,165,233,0.10);
      text-decoration:none; color:inherit;
      transition:box-shadow .15s ease, border-color .15s ease, background .15s ease;
    }
    a.cellbox:hover{ box-shadow:0 2px 10px rgba(0,0,0,.06); border-color:var(--accent); background:rgba(14,165,233,0.14); }

    /* 날짜 배지 */
    .dnum-badge{
      position:absolute; left:10px; top:10px; z-index:3;
      font-size:12px; color:var(--muted);
      padding:2px 6px; border:1px solid var(--line); border-radius:8px;
      background:var(--box);
    }

    /* 중앙 콘텐츠 */
    .center{flex:1; display:flex; flex-direction:column; align-items:center; justify-content:center; text-align:center; padding:6px 4px;}
    .title-center{
      max-width:100%;
      font-size:16px; line-height:1.4;
      white-space:normal; word-break:keep-all; text-wrap:balance;
      overflow:hidden; display:-webkit-box; -webkit-line-clamp:3; -webkit-box-orient:vertical; margin:0;
    }
    .ref{margin-top:8px;font-size:12px;color:var(--muted);white-space:nowrap;overflow:hidden;text-overflow:ellipsis;}

    /* 다크 모드 미세 조정 */
    @media (prefers-color-scheme: dark){
      .cellbox{ background:rgba(56,189,248,0.12); }
      .dnum-badge{ background:#0f1720; border-color:#334155; color:#9ca3af; }
    }

    /* ==== 공통 상단 네비(사이트) ==== */
    .site-nav {background:#0f172a;color:#fff;position:sticky;top:0;z-index:20}
    .site-nav nav{display:flex;flex-wrap:wrap;gap:10px;justify-content:center;align-items:center;padding:12px}
    .site-nav a{color:#fff;text-decoration:none;opacity:.9;padding:4px 6px;border-radius:8px}
    .site-nav a:hover,.site-nav a:focus{opacity:1;text-decoration:underline}
    .site-nav a[aria-current="page"]{opacity:1;background:rgba(255,255,255,.12)}
    .site-nav .sep{opacity:.35}
    .site-nav small { opacity: .8; font-size: 0.9em; }

   /* ==== 제목 숨김 (월 제목 표시 X) ==== */
h1#page-title, h1.page-title{
  display:none !important;
}
.topbar, .header, #title-wrap{ overflow:visible !important; height:auto !important; } 
  </style>
</head>
<body>

  <!-- 공통 네비 (중복 제거, 한 번만) -->
<header class="site-nav" role="navigation" aria-label="사이트 공통 메뉴">
  <nav>
    <a href="https://noemisuh.github.io/faith-scripture/">믿음으로 쓰는 성경</a>
    <span class="sep" aria-hidden="true">|</span>
    <a href="https://noemisuh.github.io/faith-bible-copy/">필사 성경</a>
    <span class="sep" aria-hidden="true">|</span>
    <a href="https://noemisuh.github.io/streams-of-the-word/">말씀따라 흐르는 샘물</a>
    <span class="sep" aria-hidden="true">|</span>

    <!-- 블로그 묶음 (스크립트가 이 span의 텍스트만 교체) -->
<span aria-label="블로그 바로가기">
  블로그
  <small>(
    <a id="tistory-link"
       href="https://noemisuh.tistory.com/category/%EC%8B%9C%EC%99%80%20%EA%B3%A0%EB%B0%B1"
       target="_blank" rel="noopener">Tistory</a> |
    <a href="https://blog.naver.com/noemisuh/224058295053" target="_blank" rel="noopener">Naver</a>
  )</small>
</span>

<!-- 언어 스위처는 블로그 span 바깥에 둠 (스크립트 교체 영향 안 받도록) -->
<span id="lang-switch" style="margin-left:8px; opacity:.85">
  <a href="#" data-lang="ko">한국어</a> |
  <a href="#" data-lang="es">Español</a> |
  <a href="#" data-lang="en">English</a> |
  <a href="#" data-lang="zh">中文</a>
</span>
  </nav>
</header>

  <div class="wrap">
    <!-- 제목 -->
    <header id="title-wrap"><h1 id="page-title" class="page-title"></h1></header>

    <!-- 상단 브랜드/연/월 -->
    <section class="top" aria-label="상단">
      <div class="brand"><span class="dot" aria-hidden="true"></span><span>말씀따라 흐르는 샘물</span></div>
      <nav class="yearbar" aria-label="년도">
        <a id="prevYear" href="#" aria-label="이전 해">◀</a>
        <span class="yr" id="yearLabel">0000</span>
        <a id="nextYear" href="#" aria-label="다음 해">▶</a>
      </nav>
      <nav class="monthbar" id="monthbar" aria-label="월"></nav>
    </section>

    <!-- 달력 -->
    <section class="cal" aria-label="달력">
      <div class="head"><div>일</div><div>월</div><div>화</div><div>수</div><div>목</div><div>금</div><div>토</div></div>
      <div id="grid" class="grid" role="grid" aria-label="달력 그리드"></div>
    </section>
  </div>

<script>
(function(){
  /* ===== I18N 설정 (ko, es, en, zh) ===== */
  var I18N = {
    ko: {
      brand: "말씀따라 흐르는 샘물",
      daysShort: ["일","월","화","수","목","금","토"],
      monthsShort:["1월","2월","3월","4월","5월","6월","7월","8월","9월","10월","11월","12월"],
      monthsFull: ["1","2","3","4","5","6","7","8","9","10","11","12"],
      nav: { root:"믿음으로 쓰는 성경", copy:"필사 성경", streams:"말씀따라 흐르는 샘물", blog:"블로그" },
      title: (y,m)=> `${y}년 ${m}월`
    },
    es: {
      brand: "Riachuelos de la Palabra",
      daysShort: ["Dom","Lun","Mar","Mié","Jue","Vie","Sáb"],
      monthsShort:["Ene","Feb","Mar","Abr","May","Jun","Jul","Ago","Sep","Oct","Nov","Dic"],
      monthsFull: ["enero","febrero","marzo","abril","mayo","junio","julio","agosto","septiembre","octubre","noviembre","diciembre"],
      nav: { root:"Biblia por fe", copy:"Biblia copiada a mano", streams:"Riachuelos de la Palabra", blog:"Blog" },
      title: (y,mname)=> `${mname} de ${y}`
    },
    en: {
      brand: "Streams of the Word",
      daysShort: ["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],
      monthsShort:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],
      monthsFull: ["January","February","March","April","May","June","July","August","September","October","November","December"],
      nav: { root:"Faith Scripture", copy:"Hand-copied Bible", streams:"Streams of the Word", blog:"Blog" },
      title: (y,mname)=> `${mname} ${y}`
    },
    zh: {
      brand: "话语之溪流",
      daysShort: ["日","一","二","三","四","五","六"],
      monthsShort:["1月","2月","3月","4月","5月","6月","7月","8月","9月","10月","11月","12月"],
      monthsFull: ["一月","二月","三月","四月","五月","六月","七月","八月","九月","十月","十一月","十二月"],
      nav: { root:"凭信写圣经", copy:"手抄圣经", streams:"话语之溪流", blog:"博客" },
      title: (y,mname)=> `${y}年${mname}`
    }
  };

  /* ===== 날짜/URL 파싱 ===== */
  var now = new Date();
  var u = new URL(location.href);
  var hash = (location.hash || '').replace('#','').trim(); // "YYYY-MM"
  var hashYm = hash.match(/^(\d{4})-(0[1-9]|1[0-2])$/);
  var y = parseInt(u.searchParams.get('y') || (hashYm?hashYm[1]:now.getFullYear()),10);
  var m = parseInt(u.searchParams.get('m') || (hashYm?hashYm[2]:(now.getMonth()+1)),10);
  if(!(y>=1900&&y<=9999)) y = now.getFullYear();
  if(!(m>=1&&m<=12)) m = now.getMonth()+1;
  var mm = String(m).padStart(2,'0');

  /* ===== 언어 결정(쿼리 > 저장값 > ko) ===== */
  var qLang = (u.searchParams.get('lang')||'').toLowerCase();
  var saved = localStorage.getItem('sow_lang') || '';
  var lang = qLang || saved || 'ko';
  if(!I18N[lang]) lang='ko';
  localStorage.setItem('sow_lang', lang);
  document.documentElement.setAttribute('lang', lang);
  var I = I18N[lang];

  /* ===== 플랫폼 감지 (네이버/티스토리 우회 링크용) ===== */
  var PLATFORM = (u.searchParams.get('target') || '').toLowerCase();
  if(!PLATFORM){
    var host = location.hostname;
    if(host.indexOf('naver.com')>-1) PLATFORM='naver';
    else if(host.indexOf('tistory.com')>-1) PLATFORM='tistory';
    else PLATFORM='web';
  }

  /* ===== 이동 함수 ===== */
  function go(y2,m2){
    var nu = new URL(location.href);
    nu.searchParams.set('y', String(y2));
    nu.searchParams.set('m', String(m2));
    nu.searchParams.set('lang', lang);     // 언어 유지
    nu.searchParams.set('v', Date.now());  // 캐시버스터
    location.href = nu.toString();
  }
  window.goYear = function(delta){ go(y+delta, m); };

  /* ===== 상단 UI 바인딩 + i18n 적용 ===== */
  var yLabel = document.getElementById('yearLabel');
  if (yLabel) yLabel.textContent = y;

  var prev = document.getElementById('prevYear');
  var next = document.getElementById('nextYear');
  if (prev) prev.onclick = function(e){ e.preventDefault(); go(y-1, m); };
  if (next) next.onclick = function(e){ e.preventDefault(); go(y+1, m); };

  // 브랜드 라벨
  var brandText = document.querySelector('.brand span:last-child');
  if (brandText) brandText.textContent = I.brand;

  // 상단 네비 텍스트 교체
  try{
    var aRoot    = document.querySelector('.site-nav a[href*="faith-scripture"]');
    var aCopy    = document.querySelector('.site-nav a[href*="faith-bible-copy"]');
    var aStreams = document.querySelector('.site-nav a[href*="streams-of-the-word"]');
    var spanBlog = document.querySelector('.site-nav span[aria-label]');
    if(aRoot)    aRoot.textContent    = I.nav.root;
    if(aCopy)    aCopy.textContent    = I.nav.copy;
    if(aStreams) aStreams.textContent = I.nav.streams;
    if(spanBlog){
      var small = spanBlog.querySelector('small');
      spanBlog.textContent = I.nav.blog + " ";
      if(small) spanBlog.appendChild(small); // (Tistory|Naver) 부분 유지
    }
  }catch(_){}

  // 월 바(i18n)
  var mbar  = document.getElementById('monthbar');
  if (mbar){
    mbar.innerHTML = '';
    for(var i=1;i<=12;i++){
      (function(ii){
        var a = document.createElement('a');
        a.href = '#'; a.textContent = I.monthsShort[ii-1];
        if(ii===m) a.className = 'active';
        a.onclick = function(e){ e.preventDefault(); go(y, ii); };
        mbar.appendChild(a);
      })(i);
    }
  }

  /* ===== 네이버/티스토리 링크 맵 ===== */
  var linkMap = Object.create(null);
  function loadLinkMap(){
    return fetch('data/links-map.txt?v=' + Date.now(), {cache:'no-store'})
      .then(function(r){ return r.ok ? r.text() : ''; })
      .then(function(t){
        if(!t) return;
        if(t.charCodeAt && t.charCodeAt(0)===0xFEFF) t = t.slice(1);
        t.replace(/\r\n?/g,'\n').split('\n').forEach(function(line){
          line = (line||'').trim();
          if(!line || line[0]==='#') return;
          var p = line.split('|').map(function(s){return s.trim();});
          if(p.length < 2) return;
          linkMap[p[0]] = p[1];
        });
      }).catch(function(){});
  }
  function getHref(original){
    if(!original) return '';
    if(PLATFORM === 'naver' && linkMap[original]) return linkMap[original];
    return original;
  }

  /* ===== 요일 헤더(i18n) ===== */
  var head = document.querySelector('.cal .head');
  if(head){
    head.innerHTML = '';
    I.daysShort.forEach(function(d){
      var dv = document.createElement('div');
      dv.textContent = d;
      head.appendChild(dv);
    });
  }

  /* ===== 데이터 파서: DD | 제목/타이틀 | (선택) 본문/Referencia | 링크 ===== */
  var dayMap = Object.create(null);
  function parseText(t){
    if(!t) return;
    if(t.charCodeAt && t.charCodeAt(0)===0xFEFF) t = t.slice(1);
    var lines = t.replace(/\r\n?/g,'\n').split('\n');
    for(var i=0;i<lines.length;i++){
      var line = lines[i].trim(); if(!line) continue;
      var parts = line.split('|').map(function(s){ return s.trim(); });
      if(parts.length < 3) continue;
      var d = parseInt(parts[0],10); if(!(d>=1 && d<=31)) continue;
      var title = parts[1] || '';
      var ref   = (parts.length>=4 ? parts[2] : '');
      var href  = (parts.length>=4 ? parts[3] : parts[2]) || '';
      dayMap[d] = {title:title, ref:ref, href:href};
    }
  }

  /* ===== 문서 탭 제목(i18n) ===== */
  function setPageTitle(yy, mmNum){
    var nice = (lang==='es')
      ? I.title(yy, I.monthsFull[mmNum-1])
      : (lang==='en')
        ? I.title(yy, I.monthsFull[mmNum-1])
        : (lang==='zh')
          ? I.title(yy, I.monthsFull[mmNum-1])
          : I.title(yy, mmNum);
    document.title = I.brand + ' - ' + nice;
  }

  /* ===== 렌더링 ===== */
  function render(){
    var grid = document.getElementById('grid'); if(!grid) return;
    grid.innerHTML = '';

    var first = new Date(y, m-1, 1);
    var start = first.getDay();
    var days  = new Date(y, m, 0).getDate();

    var cells = [];
    for(var s=0;s<start;s++) cells.push({empty:true});
    for(var d=1; d<=days; d++) cells.push({empty:false, d:d, info:dayMap[d]});
    while(cells.length % 7 !== 0) cells.push({empty:true});

    cells.forEach(function(c){
      var cell = document.createElement('div');
      cell.className = 'cell';
      if(c.empty){ grid.appendChild(cell); return; }

      var info = c.info;
      var box = (info && info.href) ? document.createElement('a') : document.createElement('div');
      box.className = 'cellbox';

      var finalHref = info ? getHref(info.href) : '';
      if(finalHref){ box.href = finalHref; box.target = '_blank'; box.rel='noopener'; }

      var badge = document.createElement('div');
      badge.className = 'dnum-badge';
      badge.textContent = c.d;
      box.appendChild(badge);

      var center = document.createElement('div');
      center.className = 'center';

      var titleEl = document.createElement('div');
      titleEl.className = 'title-center';
      titleEl.textContent = (info && info.title) ? info.title : '';
      center.appendChild(titleEl);

      if(info && info.ref){
        var r = document.createElement('div');
        r.className='ref';
        r.textContent = info.ref;
        center.appendChild(r);
      }

      box.appendChild(center);
      cell.appendChild(box);
      grid.appendChild(cell);
    });

    setPageTitle(y, m);
  }

  /* ===== 파일 로딩 (lang 우선 → ko → 기본) ===== */
  function tryFetch(url){
    return fetch(url + '?v=' + Date.now(), {cache:'no-store'})
            .then(function(r){ return r.ok ? r.text() : ''; })
            .catch(function(){ return ''; });
  }
  function load(){
    var langUrl = 'data/' + y + '-' + mm + '.' + lang + '.txt';
    var koUrl   = 'data/' + y + '-' + mm + '.ko.txt';
    var baseUrl = 'data/' + y + '-' + mm + '.txt';

    return tryFetch(langUrl).then(function(t){
      if(t){ parseText(t); render(); return; }
      return tryFetch(koUrl).then(function(t2){
        if(t2){ parseText(t2); render(); return; }
        return tryFetch(baseUrl).then(function(t3){
          parseText(t3); render();
        });
      });
    }).catch(function(){ render(); });
  }

  /* ===== 시작 ===== */
  loadLinkMap().then(load);

  /* 현재 페이지 강조(네비) */
  (function(){
    var here = location.href.replace(/\/index\.html?$/,'').replace(/\/$/,'');
    document.querySelectorAll('.site-nav a').forEach(function(a){
      var href = a.href.replace(/\/index\.html?$/,'').replace(/\/$/,'');
      if (here === href || (here.startsWith(href) && href.length>20)) {
        a.setAttribute('aria-current','page');
      }
    });
  })();

  /* ===== 언어 스위처(상단 네비 오른쪽에 있으면 작동) ===== */
  (function setupLangSwitch(){
    var box = document.getElementById('lang-switch');
    if(!box) return;
    box.addEventListener('click', function(e){
      var a = e.target.closest('a[data-lang]');
      if(!a) return;
      e.preventDefault();
      var newLang = a.getAttribute('data-lang');
      try{ localStorage.setItem('sow_lang', newLang); }catch(_){}
      var u = new URL(location.href);
      u.searchParams.set('lang', newLang);
      u.searchParams.set('v', Date.now());
      location.href = u.toString();
    });
  })();

})();
</script>

<script>
(function () {
  // 1) 언어별 Tistory 도메인/경로 (필요시 en/zh 실제 도메인으로 교체)
  const TISTORY_BY_LANG = {
    ko: "https://noemisuh.tistory.com/category/%EC%8B%9C%EC%99%80%20%EA%B3%A0%EB%B0%B1",
    es: "https://gloriadios-es.tistory.com",
    en: "https://noemisuh.tistory.com",
    zh: "https://noemisuh.tistory.com"
  };

  // 2) 요소 찾기
  const tistoryA = document.getElementById("tistory-link");
  const langLinks = document.querySelectorAll("#lang-switch a[data-lang]");

// 3) 현재 언어 추정(있으면 사용, 없으면 ko)
function detectInitialLang() {
  // (0) html lang 속성(앞쪽 스크립트에서 이미 설정함)
  const htmlLang = (document.documentElement.getAttribute('lang') || '').toLowerCase();
  if (/(ko|es|en|zh)/.test(htmlLang)) return htmlLang;

  // (1) URL 쿼리 ?lang=...
  const m1 = location.search.match(/[?&]lang=(ko|es|en|zh)\b/i);
  if (m1) return m1[1].toLowerCase();

  // (2) 해시 #lang=...
  const m2 = location.hash.match(/lang=(ko|es|en|zh)\b/i);
  if (m2) return m2[1].toLowerCase();

  // (3) localStorage(sow_lang) — 앞쪽 스크립트가 저장함
  try {
    const ls = localStorage.getItem('sow_lang');
    if (/(ko|es|en|zh)/.test(ls)) return ls.toLowerCase();
  } catch (_) {}

  // (4) body data-lang
  const bodyLang = document.body?.dataset?.lang;
  if (/(ko|es|en|zh)/.test(bodyLang)) return bodyLang.toLowerCase();

  // (5) 기본값
  return "ko";
}

// 5) 초기 적용 (← 이 블록은 함수 “밖”에 있어야 함)
const initLang = detectInitialLang();
applyLang(initLang);
// 혹시 이후 다른 스크립트가 href를 바꿔도 다시 고정
setTimeout(() => applyLang(initLang), 0);

  function applyLang(lang) {
    const url = TISTORY_BY_LANG[lang] || TISTORY_BY_LANG.ko;
    if (tistoryA) {
      tistoryA.href = url;
      tistoryA.target = "_blank";
      tistoryA.rel = "noopener";
    }
  }

  // 4) 스위처 클릭 시 반영
  langLinks.forEach(a => {
    a.addEventListener("click", e => {
      e.preventDefault();
      const lang = a.dataset.lang;
      applyLang(lang);

      // 선택 상태 표시(선택사항)
      langLinks.forEach(x => x.classList.remove("active"));
      a.classList.add("active");
    });
  });

  // 5) 초기 적용
  applyLang(detectInitialLang());
})();
</script>
</body>
</html>
