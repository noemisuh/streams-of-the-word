<!doctype html>
<html lang="ko">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>ë§ì”€ë”°ë¼ íë¥´ëŠ” ìƒ˜ë¬¼</title>
<meta name="color-scheme" content="light dark">

<style>
  :root {
    --fg:#111827; --muted:#6b7280; --line:#d1d5db; --line-strong:#9ca3af;
    --accent:#0ea5e9; --bg:#ffffff; --bgsoft:#f8fafc; --box:#ffffff; --box-line:#d1d5db; --box-tint:#f0f9ff;
  }
  @media (prefers-color-scheme: dark){
    :root { --fg:#e5e7eb; --muted:#9ca3af; --line:#2b2f36; --line-strong:#4b5563; --bg:#0b0f14; --bgsoft:#0f141a; --box:#0c1218; --box-line:#1f2937; --box-tint:#0c141c; }
    body { background: var(--bg); }
  }
  * { box-sizing:border-box; }
  body { margin:0; font-family: ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Noto Sans KR", "Apple SD Gothic Neo", sans-serif; color:var(--fg); background:var(--bg); }
  .wrap { max-width: 940px; margin: 28px auto; padding: 0 12px; }

header { display:flex; justify-content:center; align-items:center; margin:6px 0 4px; }
/* í—¤ë” ë°°ì§€ + ë§í¬ ìŠ¤íƒ€ì¼ */
.brand{
  display:inline-flex;
  align-items:center;
  justify-content:center;
  padding:6px 14px;
  border:1.5px solid var(--line-strong);
  border-radius:999px;
  background:var(--bgsoft);
  text-decoration:none;   /* ë§í¬ ë°‘ì¤„ ì œê±° */
  color:inherit;          /* ë§í¬ ìƒ‰ìƒ ìƒì† */
}
.brand h1{ font-size:16px; margin:0; letter-spacing:-0.2px; font-weight:700; }

/* ì—°ë„ ë°” (ëŠê¸´ ì¤„ ë³µêµ¬ + ì¤‘ë³µ ì œê±°) */
.yearbar{
  display:flex;
  justify-content:center;
  margin:6px 0;
}
.yearbar .year { font-size:16px; font-weight:700; letter-spacing:-0.3px; }

/* ì›” ë°” */
.monthbar { display:flex; gap:10px; flex-wrap:wrap; justify-content:center; margin:4px 0 10px; }
.monthbar a { text-decoration:none; color:var(--muted); padding:2px 0; font-size:14px; }
.monthbar a.active { color:var(--accent); font-weight:700; }

table.cal { 
  width:100%;
  border-collapse:separate;
  border-spacing:0;
  table-layout:fixed;
}
.cal thead th {
  background:var(--bgsoft);
  position:sticky;
  top:0;
  z-index:1;
  font-weight:700;
  padding:8px;
  font-size:13px;
  border-bottom:2px solid var(--line-strong);
  border-top:1.5px solid var(--line-strong);
  border-left:1.5px solid var(--line-strong);
  text-align:center;
}
.cal thead th:last-child { border-right:1.5px solid var(--line-strong); }

.cal tbody td {
  padding:6px;
  position:relative;
  background:var(--bg);
  border-left:1.5px solid var(--line);
  border-bottom:1.5px solid var(--line);
}
.cal tbody tr:last-child td { border-bottom:1.5px solid var(--line-strong); }
.cal tbody td:last-child { border-right:1.5px solid var(--line-strong); }
.cal tbody td:first-child { border-left:1.5px solid var(--line-strong); }

.daynum {
  display:block;
  font-size:11px;
  color:var(--muted);
  user-select:none;
  text-align:center;
  margin-top:2px;
}

/* ìº˜ë¦°ë” ë°•ìŠ¤ */
.box {
  width:100%;
  aspect-ratio:1/1;
  margin-top:4px;
  border:1.5px solid var(--box-line);
  background:linear-gradient(180deg, var(--box-tint) 0%, var(--box) 80%);
  border-radius:12px;
  position:relative;
  overflow:hidden;
  box-shadow:0 1px 0 rgba(0,0,0,.02), 0 6px 12px rgba(0,0,0,.04);
  transition:border-color .15s, box-shadow .15s, transform .06s;
  display:flex;
  flex-direction:column;
  justify-content:center;
  align-items:center;
  text-align:center;
  padding:8px 10px;
}
.box.link { cursor:pointer; }
.box.link:hover { border-color:var(--accent); box-shadow:0 1px 0 rgba(0,0,0,.03), 0 10px 18px rgba(0,0,0,.08); }
.box.link:active { transform: translateY(1px); }

.title { 
  text-align:center;
  white-space:normal;
  word-break:keep-all;
  overflow-wrap:anywhere;
  line-height:1.45;
  margin-bottom:4px;
}
.ref { text-align:center; font-size:13px; }
.box .title { font-size:14.5px; }

@media (max-width:640px){
  .wrap { margin:20px auto; }
  .brand h1 { font-size:15px; }
  .yearbar .year { font-size:15px; }
  .monthbar a { font-size:13px; }
  .cal thead th { padding:8px; font-size:12px; }
  .title { line-height:1.45; }
}
</style>
</head>
<body>
  <div class="wrap">
    <header>
      <a class="brand" id="brand-link" href="index.html?y=2025&m=9" rel="noopener">
        <h1>ë§ì”€ë”°ë¼ íë¥´ëŠ” ìƒ˜ë¬¼</h1>
      </a>
    </header>

<!-- ğŸ”Š ì›”ë³„ ì°¬ì–‘ ë¯¸ë‹ˆ í”Œë ˆì´ì–´ -->
<div id="player" style="display:flex;gap:8px;justify-content:center;align-items:center;margin:10px 0;">
  <button id="playBtn" style="padding:6px 10px;border:1px solid var(--line-strong);border-radius:10px;background:var(--bgsoft);cursor:pointer">
    ğŸ”Š ì°¬ì–‘ ì¬ìƒ
  </button>
  <!-- MP3ìš© ì˜¤ë””ì˜¤ (ê¸°ë³¸ ìˆ¨ê¹€) -->
  <audio id="audio" preload="none" controls style="display:none;"></audio>
  <!-- ìœ íŠœë¸Œìš© iframe (ê¸°ë³¸ ìˆ¨ê¹€) -->
  <iframe id="yt" width="320" height="180" style="display:none;border:none"
          src="" allow="autoplay; encrypted-media; picture-in-picture" allowfullscreen></iframe>
</div>

    <div class="yearbar" aria-label="ì—°ë„">
      <div class="year" id="year-label"></div>
    </div>
    <div class="monthbar" id="monthbar" aria-label="ì›” ì„ íƒ"></div>

    <table class="cal" aria-label="ì›”ë ¥" id="cal">
      <thead>
        <tr><th scope="col">ì¼</th><th scope="col">ì›”</th><th scope="col">í™”</th><th scope="col">ìˆ˜</th><th scope="col">ëª©</th><th scope="col">ê¸ˆ</th><th scope="col">í† </th></tr>
      </thead>
      <tbody id="tbody"></tbody>
    </table>
  </div>

  <script>
  /* ===== ì„¤ì • ===== */
  const DATA_DIR = 'data';     // ë°ì´í„° í´ë”
/* ===== ì›”ë³„ ì°¬ì–‘ ë§¤í•‘ ===== */
// ì˜ˆì‹œ) 2025ë…„ 9ì›”: ìœ íŠœë¸Œ ì˜ìƒID, 10ì›”: MP3 ë§í¬
const HYMN = {
  "2025-09": { type: "yt",  src: "ì˜ìƒID_ì—¬ê¸°ì—",               title: "2025ë…„ 9ì›” ì°¬ì–‘" },
  // "2025-10": { type: "mp3", src: "https://example.com/oct.mp3", title: "2025ë…„ 10ì›” ì°¬ì–‘" },
};
  const DEFAULT_YEAR = 2025;   // ì´ˆê¸° í‘œì‹œ ì—°ë„
  const DEFAULT_MONTH = 9;     // ì´ˆê¸° í‘œì‹œ ì›” (1~12)

/* ===== ì›”ë³„ ì°¬ì–‘ í”Œë ˆì´ì–´ ===== */
function setupHymnPlayer(year, month){
  const ymKey = `${year}-${String(month).padStart(2,'0')}`;
  const info = HYMN[ymKey];

  const playBtn = document.getElementById('playBtn');
  const audio  = document.getElementById('audio');
  const yt     = document.getElementById('yt');

  // ì´ˆê¸°í™”
  if (audio) { audio.pause(); audio.src=""; audio.style.display="none"; }
  if (yt)    { yt.src=""; yt.style.display="none"; }
  if (playBtn) playBtn.disabled = !info;

  if (!info){
    if (playBtn) playBtn.textContent = "ğŸ”‡ ì´ë²ˆ ë‹¬ ì°¬ì–‘ ì—†ìŒ";
    return;
  }
  playBtn.textContent = `ğŸ”Š ${info.title} ì¬ìƒ`;

  // ë²„íŠ¼ í´ë¦­ ì‹œ ì¬ìƒ (ëª¨ë°”ì¼ ìë™ì¬ìƒ ì œí•œ íšŒí”¼)
  playBtn.onclick = ()=>{
    if (info.type === "mp3"){
      audio.src = info.src;
      audio.style.display = "block";
      audio.play().catch(()=>{}); // ë¸Œë¼ìš°ì € ì •ì±…ìœ¼ë¡œ ì‹¤íŒ¨í•  ìˆ˜ ìˆìŒ
    } else if (info.type === "yt"){
      // ìœ íŠœë¸Œ ìë™ì¬ìƒ + ë°˜ë³µ
      yt.src = `https://www.youtube.com/embed/${info.src}?autoplay=1&loop=1&playlist=${info.src}`;
      yt.style.display = "block";
    }
  };

  // ì¿¼ë¦¬ íŒŒë¼ë¯¸í„°ë¡œ ì¦‰ì‹œ ì¬ìƒ íŠ¸ë¦¬ê±° (?autoplay=1)
  const params = new URL(location.href).searchParams;
  if (params.get('autoplay') === '1'){
    setTimeout(()=> playBtn.click(), 150);
  }
}
    
  /* ===== ìœ í‹¸ ===== */
  const pad2 = n => String(n).padStart(2,'0');
  const qs = (s,r=document)=>r.querySelector(s);

  function getYMFromURL(){
    const u = new URL(location.href);
    let y = Number(u.searchParams.get('y')) || DEFAULT_YEAR;
    let m = Number(u.searchParams.get('m')) || DEFAULT_MONTH;
    // í•´ì‹œ #YYYY-MM ë„ í—ˆìš©
    const h = (location.hash||'').replace('#','').trim();
    if(/^\d{4}-\d{2}$/.test(h)){
      const [hy, hm] = h.split('-').map(Number);
      if(hy && hm>=1 && hm<=12){ y=hy; m=hm; }
    }
    return { y, m };
  }

  /* ===== ë°ì´í„° ë¡œë”© (ì›”ë³„ â†’ ì—°ê°„ í´ë°±) ===== */
  async function tryFetch(path){
    try{
      const r = await fetch(`${path}?v=${Date.now()}`); // ìºì‹œë²„ìŠ¤í„°
      if(!r.ok) return null;
      return await r.text();
    }catch(e){ return null; }
  }
  // ì›”ë³„ í¬ë§·: "DD|ì œëª©|ë³¸ë¬¸(ì„ íƒ)|URL(ì„ íƒ)"
  function parseMonthly(text){
    return text.split(/\r?\n/).map(l=>l.trim()).filter(l=>l && !l.startsWith('#')).map(l=>{
      const [d, title='', ref='', url=''] = l.split('|').map(s=>(s||'').trim());
      return { day: Number(d)||0, title, ref, url };
    }).filter(e=>e.day>=1 && e.day<=31);
  }
  // ì—°ê°„ í¬ë§·: "MM-DD|ì œëª©|ë³¸ë¬¸(ì„ íƒ)|URL(ì„ íƒ)" â†’ í•´ë‹¹ ì›”ë§Œ
  function parseYearly(text, month){
    const mm = pad2(month);
    return text.split(/\r?\n/).map(l=>l.trim())
      .filter(l=>l && !l.startsWith('#') && l.startsWith(mm+'-'))
      .map(l=>{
        const [md, title='', ref='', url=''] = l.split('|').map(s=>(s||'').trim());
        const day = Number((md.split('-')[1]||'0'));
        return { day, title, ref, url };
      }).filter(e=>e.day>=1 && e.day<=31);
  }
  async function loadMonthData(year, month){
    const ym = `${year}-${pad2(month)}`;
    const monthly = await tryFetch(`${DATA_DIR}/${ym}.txt`);
    if(monthly!=null) return parseMonthly(monthly);
    const yearly = await tryFetch(`${DATA_DIR}/${year}.txt`);
    if(yearly!=null) return parseYearly(yearly, month);
    return [];
  }
    
  /* ===== ë Œë”ë§ ===== */
  function setYearLabel(year){
    const y = qs('#year-label');
    if(y) y.textContent = `${year}ë…„`;
  }
  function buildMonthBar(year, month){
    const mb = qs('#monthbar');
    if(!mb) return;
    mb.innerHTML = '';
    for(let m=1;m<=12;m++){
      const a = document.createElement('a');
      a.href = '#';
      a.textContent = `${m}ì›”`;
      if(m===month) a.classList.add('active');
      a.addEventListener('click', (ev)=>{
        ev.preventDefault();
        const url = new URL(location.href);
        url.searchParams.set('y', String(year));
        url.searchParams.set('m', String(m));
        history.pushState({},'',url);
        render(year,m);
      });
      mb.appendChild(a);
    }
  }
  function monthMeta(year, month){
    const first = new Date(year, month-1, 1);
    const last  = new Date(year, month, 0);
    return { startWeekday: first.getDay(), totalDays: last.getDate() };
  }
  function makeDayCellHTML(dayNum, entry){
    const titleHTML = entry?.title
      ? (entry.url ? `<a href="${entry.url}" target="_blank" rel="noopener">${entry.title}</a>` : entry.title)
      : (entry?.url ? `<a href="${entry.url}" target="_blank" rel="noopener">ì—´ê¸°</a>` : '');
    const refHTML = entry?.ref ? `<div class="ref">${entry.ref}</div>` : '';
    const linkClass = entry?.url ? 'box link' : 'box';
    return `
      <td>
        <span class="daynum">${dayNum}</span>
        <div class="${linkClass}" ${entry?.url ? `onclick="window.open('${entry.url}','_blank','noopener')"`:''}>
          <div class="title" style="padding:8px 10px 4px; font-size:13px;">${titleHTML||''}</div>
          <div style="padding:0 10px 10px; font-size:12px; color:var(--muted)">${refHTML}</div>
        </div>
      </td>
    `;
  }
  function buildTableBody(year, month, entries){
    const { startWeekday, totalDays } = monthMeta(year, month);
    const byDay = new Map(entries.map(e=>[e.day, e]));
    let html = '', day = 1;
    for(let row=0; row<6; row++){
      html += '<tr>';
      for(let col=0; col<7; col++){
        const idx = row*7 + col;
        if(idx < startWeekday || day > totalDays){
          html += '<td></td>';
        }else{
          html += makeDayCellHTML(day, byDay.get(day));
          day++;
        }
      }
      html += '</tr>';
    }
    return html;
  }

  /* ===== ì‹œì‘ & ë’¤/ì• ì´ë™ ===== */
  window.addEventListener('DOMContentLoaded', ()=>{
    const { y, m } = getYMFromURL();
    render(y, m);
  });
  window.addEventListener('popstate', ()=>{
    const { y, m } = getYMFromURL();
    render(y, m);
  });
async function render(year, month){
  setYearLabel(year);
  buildMonthBar(year, month);
  const tbody = qs('#tbody');
  if(tbody) tbody.innerHTML = `<tr><td colspan="7" style="padding:20px; text-align:center; color:var(--muted)">ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘â€¦</td></tr>`;
  const entries = await loadMonthData(year, month);
  if(tbody) tbody.innerHTML = buildTableBody(year, month, entries);

  // â¬‡ï¸ ì¶”ê°€: ì›”ë³„ ì°¬ì–‘ í”Œë ˆì´ì–´ ì„¸íŒ…
  setupHymnPlayer(year, month);
}  
  </script>
</body>
</html>
