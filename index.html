<!doctype html>
<html lang="ko">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>ë§ì”€ë”°ë¼ íë¥´ëŠ” ìƒ˜ë¬¼</title>
<meta name="color-scheme" content="light dark">
<style>
  :root {
    --fg:#111827; --muted:#6b7280; --line:#d1d5db; --line-strong:#9ca3af;
    --accent:#0ea5e9; --bg:#ffffff; --bgsoft:#f8fafc; --box:#ffffff; --box-line:#d1d5db; --box-tint:#f0f9ff;
  }
  @media (prefers-color-scheme: dark){
    :root { --fg:#e5e7eb; --muted:#9ca3af; --line:#2b2f36; --line-strong:#4b5563; --bg:#0b0f14; --bgsoft:#0f141a; --box:#0c1218; --box-line:#1f2937; --box-tint:#0c141c; }
    body { background: var(--bg); }
  }
  * { box-sizing:border-box; }
  body { margin:0; font-family: ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Noto Sans KR", "Apple SD Gothic Neo", sans-serif; color:var(--fg); background:var(--bg); }
  .wrap { max-width: 940px; margin: 28px auto; padding: 0 12px; }

  header { display:flex; justify-content:center; align-items:center; margin:6px 0 4px; }
  .brand { display:inline-flex; align-items:center; justify-content:center; padding:6px 14px; border:1.5px solid var(--line-strong); border-radius:999px; background:var(--bgsoft); }
  .brand h1 { font-size:16px; margin:0; letter-spacing:-0.2px; font-weight:700; }

  .yearbar { display:flex; justify-content:center; margin:6px 0; }
  .yearbar .year { font-size:16px; font-weight:700; letter-spacing:-0.3px; }
  .monthbar { display:flex; gap:10px; flex-wrap:wrap; justify-content:center; margin:4px 0 10px; }
  .monthbar a { text-decoration:none; color:var(--muted); padding:2px 0; font-size:14px; }
  .monthbar a.active { color:var(--accent); font-weight:700; }

  table.cal { width:100%; border-collapse:separate; border-spacing:0; table-layout:fixed; }
  .cal thead th { background:var(--bgsoft); position:sticky; top:0; z-index:1; font-weight:700; padding:8px; font-size:13px; border-bottom:2px solid var(--line-strong); border-top:1.5px solid var(--line-strong); border-left:1.5px solid var(--line-strong); }
  .cal thead th:last-child { border-right:1.5px solid var(--line-strong); }
  .cal tbody td { padding:6px; position:relative; background:var(--bg); border-left:1.5px solid var(--line); border-bottom:1.5px solid var(--line); }
  .cal tbody tr:last-child td { border-bottom:1.5px solid var(--line-strong); }
  .cal tbody td:last-child { border-right:1.5px solid var(--line-strong); }
  .cal tbody td:first-child { border-left:1.5px solid var(--line-strong); }

  .daynum { display:inline-block; font-size:11px; color:var(--muted); user-select:none; }
  .box { width:100%; aspect-ratio:1/1; margin-top:4px; border:1.5px solid var(--box-line); background:linear-gradient(180deg, var(--box-tint) 0%, var(--box) 80%); border-radius:12px; position:relative; overflow:hidden; box-shadow:0 1px 0 rgba(0,0,0,.02), 0 6px 12px rgba(0,0,0,.04); transition:border-color .15s, box-shadow .15s, transform .06s; }
  .box.link { cursor:pointer; }
  .box.link:hover { border-color:var(--accent); box-shadow:0 1px 0 rgba(0,0,0,.03), 0 10px 18px rgba(0,0,0,.08); }
  .box.link:active { transform: translateY(1px); }

  @media (max-width:640px){
    .wrap { margin: 20px auto; }
    .brand h1 { font-size:15px; }
    .yearbar .year { font-size:15px; }
    .monthbar a { font-size:13px; }
    .cal thead th { padding:8px; font-size:12px; }
  }

.calendar{max-width:980px;margin:24px auto;padding:8px;}
.cal-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:8px;}
.cal-header .ym{font-weight:700;font-size:1.1rem;}
.cal-header .nav{padding:6px 10px;border:1px solid #ddd;border-radius:8px;background:#fff;cursor:pointer}
.cal-grid{display:grid;grid-template-columns:repeat(7,1fr);gap:8px;}
.dow{font-weight:700;text-align:center;opacity:.8}
.cell{border:1px solid #e5e5e5;border-radius:10px;padding:8px;min-height:84px;display:flex;flex-direction:column}
.cell.blank{background:#fafafa}
.date{font-size:.9rem;font-weight:700;margin-bottom:4px;opacity:.8}
.title{line-height:1.2}
.title a{text-decoration:none;border-bottom:1px dashed currentColor}
.ref{margin-top:4px;font-size:.85rem;opacity:.85}
@media (max-width:640px){
  .calendar{padding:4px}
  .cell{min-height:72px}
}
/* ì œëª©/ë³¸ë¬¸ ì¤„ë°”ê¿ˆ + ê°€ìš´ë° ì •ë ¬ */
.title {
  text-align: center;
  white-space: normal;        /* í•œ ì¤„ ê³ ì • í•´ì œ */
  word-break: keep-all;       /* ë‹¨ì–´ ì¤‘ê°„ ë‹¨ì ˆ ìµœì†Œí™”(í•œê¸€ ê°€ë…ì„±â†‘) */
  overflow-wrap: anywhere;    /* ë„ˆë¬´ ê¸´ ë‹¨ì–´ëŠ” ê°•ì œ ì¤„ë°”ê¿ˆ */
  line-height: 1.4;
  margin-bottom: 4px;
}
.ref { text-align: center; }

/* ë°•ìŠ¤ ì•ˆ ë‚´ìš© ìˆ˜í‰/ìˆ˜ì§ ê°€ìš´ë° ë°°ì¹˜ */
.box {
  display: flex;
  flex-direction: column;
  justify-content: center;    /* ì„¸ë¡œ ê°€ìš´ë° */
  align-items: center;        /* ê°€ë¡œ ê°€ìš´ë° */
  text-align: center;
  padding: 8px 10px;          /* ì•ˆìª½ ì—¬ë°± ì‚´ì§ */
}

/* ë‚ ì§œ ìˆ«ìë„ ê°€ìš´ë°ë¡œ (ì›í•˜ë©´) */
.daynum {
  display: block;
  text-align: center;         /* ì¢Œì¸¡ ëŒ€ì‹  ê°€ìš´ë° */
  margin-top: 2px;
}

/* ìš”ì¼ í—¤ë” ê°€ìš´ë°(ì´ë¯¸ ê·¸ë ‡ì§€ë§Œ í™•ì‹¤íˆ) */
.cal thead th { text-align: center; }

/* ëª¨ë°”ì¼ì—ì„œ ì œëª©ì´ ë„ˆë¬´ ë¶™ì–´ ë³´ì´ì§€ ì•Šê²Œ */
@media (max-width:640px){
  .title { line-height: 1.45; }
}

  /* ì œëª©/ë³¸ë¬¸ ê¸€ì í•œ ë‹¨ê³„ í‚¤ìš°ê¸° */
.box .title { font-size: 14.5px !important; line-height: 1.45; }
.box .ref   { font-size: 13px; }

</style>
</head>
<body>
<div class="wrap">
  <header><div class="brand"><h1>ë§ì”€ë”°ë¼ íë¥´ëŠ” ìƒ˜ë¬¼</h1></div></header>

  <div class="yearbar" aria-label="ì—°ë„"><div class="year" id="year-label"></div></div>
  <div class="monthbar" id="monthbar" aria-label="ì›” ì„ íƒ"></div>

  <table class="cal" aria-label="ì›”ë ¥" id="cal">
    <thead>
      <tr><th scope="col">ì¼</th><th scope="col">ì›”</th><th scope="col">í™”</th><th scope="col">ìˆ˜</th><th scope="col">ëª©</th><th scope="col">ê¸ˆ</th><th scope="col">í† </th></tr>
    </thead>
    <tbody id="tbody"></tbody>
  </table>
</div>

<!-- ğŸ‘‡ ì—¬ê¸° ìƒˆ ìŠ¤í¬ë¦½íŠ¸ ë¸”ë¡ ì „ì²´ ë¶™ì—¬ë„£ê¸° -->
<script>
/* (ì•ì„œ ë³´ë‚¸ ìŠ¤í¬ë¦½íŠ¸ ì „ì²´ë¥¼ ì—¬ê¸° ë„£ê¸°) */
</script>
</body>
</html>
  
<script>
/* ===== ì„¤ì • ===== */
const DATA_DIR = 'data';     // ë°ì´í„° í´ë”
const DEFAULT_YEAR = 2025;   // ì´ˆê¸° í‘œì‹œ ì—°ë„
const DEFAULT_MONTH = 9;      // ì´ˆê¸° í‘œì‹œ ì›” (1~12)

/* ===== ìœ í‹¸ ===== */
const pad2 = n => String(n).padStart(2,'0');
const qs = (s,r=document)=>r.querySelector(s);
const qsa = (s,r=document)=>[...r.querySelectorAll(s)];
function getYMFromURL(){
  const u = new URL(location.href);
  let y = Number(u.searchParams.get('y')) || DEFAULT_YEAR;
  let m = Number(u.searchParams.get('m')) || DEFAULT_MONTH;
  // í•´ì‹œ #YYYY-MM ë„ í—ˆìš©
  const h = (location.hash||'').replace('#','').trim();
  if(/^\d{4}-\d{2}$/.test(h)){
    const [hy, hm] = h.split('-').map(Number);
    if(hy && hm>=1 && hm<=12){ y=hy; m=hm; }
  }
  return { y, m };
}

/* ===== ë°ì´í„° ë¡œë”© (ì›”ë³„ â†’ ì—°ê°„ í´ë°±) ===== */
async function tryFetch(path){
  try{
    const r = await fetch(`${path}?v=${Date.now()}`); // ìºì‹œë²„ìŠ¤í„°
    if(!r.ok) return null;
    return await r.text();
  }catch(e){ return null; }
}
// ì›”ë³„ í¬ë§·: "DD|ì œëª©|ë³¸ë¬¸(ì„ íƒ)|URL(ì„ íƒ)"
function parseMonthly(text){
  return text.split(/\r?\n/).map(l=>l.trim()).filter(l=>l && !l.startsWith('#')).map(l=>{
    const [d, title='', ref='', url=''] = l.split('|').map(s=>(s||'').trim());
    return { day: Number(d)||0, title, ref, url };
  }).filter(e=>e.day>=1 && e.day<=31);
}
// ì—°ê°„ í¬ë§·: "MM-DD|ì œëª©|ë³¸ë¬¸(ì„ íƒ)|URL(ì„ íƒ)" â†’ í•´ë‹¹ ì›”ë§Œ
function parseYearly(text, month){
  const mm = pad2(month);
  return text.split(/\r?\n/).map(l=>l.trim())
    .filter(l=>l && !l.startsWith('#') && l.startsWith(mm+'-'))
    .map(l=>{
      const [md, title='', ref='', url=''] = l.split('|').map(s=>(s||'').trim());
      const day = Number((md.split('-')[1]||'0'));
      return { day, title, ref, url };
    }).filter(e=>e.day>=1 && e.day<=31);
}
async function loadMonthData(year, month){
  const ym = `${year}-${pad2(month)}`;
  const monthly = await tryFetch(`${DATA_DIR}/${ym}.txt`);
  if(monthly!=null) return parseMonthly(monthly);
  const yearly = await tryFetch(`${DATA_DIR}/${year}.txt`);
  if(yearly!=null) return parseYearly(yearly, month);
  return [];
}

/* ===== ë Œë”ë§ ===== */
function setYearLabel(year){
  const y = qs('#year-label');
  if(y) y.textContent = `${year}ë…„`;
}
function buildMonthBar(year, month){
  const mb = qs('#monthbar');
  if(!mb) return;
  mb.innerHTML = '';
  for(let m=1;m<=12;m++){
    const a = document.createElement('a');
    a.href = '#';
    a.textContent = `${m}ì›”`;
    if(m===month) a.classList.add('active');
    a.addEventListener('click', (ev)=>{
      ev.preventDefault();
      const url = new URL(location.href);
      url.searchParams.set('y', String(year));
      url.searchParams.set('m', String(m));
      history.pushState({},'',url);
      render(year,m);
    });
    mb.appendChild(a);
  }
}
function monthMeta(year, month){
  const first = new Date(year, month-1, 1);
  const last  = new Date(year, month, 0);
  return {
    startWeekday: first.getDay(),      // 0=ì¼
    totalDays:    last.getDate()
  };
}
function makeDayCellHTML(dayNum, entry){
  const titleHTML = entry?.title
    ? (entry.url ? `<a href="${entry.url}" target="_blank" rel="noopener">${entry.title}</a>` : entry.title)
    : (entry?.url ? `<a href="${entry.url}" target="_blank" rel="noopener">ì—´ê¸°</a>` : '');
  const refHTML = entry?.ref ? `<div class="ref">${entry.ref}</div>` : '';
  const linkClass = entry?.url ? 'box link' : 'box';

  // td ì•ˆ êµ¬ì¡°: ì¼ì, ë°•ìŠ¤(ì œëª©/ë³¸ë¬¸)
  return `
    <td>
      <span class="daynum">${dayNum}</span>
      <div class="${linkClass}" ${entry?.url ? `onclick="window.open('${entry.url}','_blank','noopener')"`:''}>
        <div class="title" style="padding:8px 10px 4px; font-size:13px;">${titleHTML||''}</div>
        <div style="padding:0 10px 10px; font-size:12px; color:var(--muted)">${refHTML}</div>
      </div>
    </td>
  `;
}
function buildTableBody(year, month, entries){
  const { startWeekday, totalDays } = monthMeta(year, month);
  const byDay = new Map(entries.map(e=>[e.day, e]));

  // 6ì£¼(ìµœëŒ€ 42ì¹¸)ë¡œ ê³ ì • í…Œì´ë¸” êµ¬ì„±
  const totalCells = 42;
  let html = '';
  let dayCounter = 1;
  for(let row=0; row<6; row++){
    html += '<tr>';
    for(let col=0; col<7; col++){
      const cellIndex = row*7 + col;
      if(cellIndex < startWeekday || dayCounter > totalDays){
        html += '<td></td>';
      }else{
        const entry = byDay.get(dayCounter);
        html += makeDayCellHTML(dayCounter, entry);
        dayCounter++;
      }
    }
    html += '</tr>';
  }
  return html;
}

/* ===== ë©”ì¸ ë Œë” ===== */
async function render(year, month){
  setYearLabel(year);
  buildMonthBar(year, month);

  // ë¡œë”© í‘œì‹œ
  const tbody = qs('#tbody');
  if(tbody) tbody.innerHTML = `<tr><td colspan="7" style="padding:20px; text-align:center; color:var(--muted)">ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘â€¦</td></tr>`;

  // ë°ì´í„° ë¡œë”©
  const entries = await loadMonthData(year, month);

  // ë³¸ë¬¸ ì±„ìš°ê¸°
  if(tbody) tbody.innerHTML = buildTableBody(year, month, entries);
}

/* ===== ì‹œì‘ & ë’¤/ì• ì´ë™ ===== */
window.addEventListener('DOMContentLoaded', ()=>{
  const { y, m } = getYMFromURL();
  render(y, m);
});
window.addEventListener('popstate', ()=>{
  const { y, m } = getYMFromURL();
  render(y, m);
});
</script>
</body>
</html>
